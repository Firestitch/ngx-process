import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { FsStoreObject } from '../classes/store-object';
import * as i0 from "@angular/core";
export class FsStore {
    constructor() {
        this._storage = window.localStorage;
        this._storeObservers = [];
    }
    observe(name) {
        return new Observable((observer) => {
            this._getObservers().push({ name: name, observer: observer });
            observer.next(new FsStoreObject(name, FsStoreObject.EVENT_INIT, this.get(name)));
        });
    }
    get(key, options = {}) {
        if (this._storage.hasOwnProperty(key)) {
            try {
                return JSON.parse(this._storage[key]);
            }
            catch (e) { }
        }
        if (options.default !== undefined) {
            return options.default;
        }
        return undefined;
    }
    set(name, value, options = {}) {
        this._storage[name] = JSON.stringify(value);
        this._getObservers()
            .filter((storeObserver) => {
            return storeObserver.name === name;
        }).forEach((storeObserver) => {
            storeObserver.observer.next(new FsStoreObject(name, FsStoreObject.EVENT_SET, value));
        });
        return this;
    }
    remove(name, options = {}) {
        delete this._storage[name];
        this._getObservers()
            .filter((item) => {
            return item.name === name;
        })
            .forEach((storeObserver) => {
            storeObserver.observer.next(new FsStoreObject(name, FsStoreObject.EVENT_REMOVE));
        });
        return this;
    }
    clear() {
        for (let i = 0; i < this._storage.length; i++) {
            const key = this._storage.key(i);
            this._getObservers().forEach(item => {
                item.observer.next(new FsStoreObject(key, FsStoreObject.EVENT_REMOVE));
            });
        }
        this._storage.clear();
        return this;
    }
    _getObservers() {
        return this._storeObservers;
    }
}
FsStore.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsStore, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
FsStore.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsStore });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsStore, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvc2VydmljZXMvc3RvcmUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxVQUFVLEVBQVksTUFBTSxNQUFNLENBQUM7QUFFNUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHlCQUF5QixDQUFDOztBQUl4RCxNQUFNLE9BQU8sT0FBTztJQURwQjtRQUdVLGFBQVEsR0FBUSxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ3BDLG9CQUFlLEdBQUcsRUFBRSxDQUFDO0tBaUU5QjtJQS9EUSxPQUFPLENBQUMsSUFBWTtRQUN6QixPQUFPLElBQUksVUFBVSxDQUFDLENBQUMsUUFBdUIsRUFBRSxFQUFFO1lBQ2hELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQzlELFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sR0FBRyxDQUFDLEdBQUcsRUFBRSxVQUFpQyxFQUFFO1FBRWpELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDckMsSUFBSTtnQkFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2FBQ3ZDO1lBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRTtTQUNmO1FBRUQsSUFBSSxPQUFPLENBQUMsT0FBTyxLQUFLLFNBQVMsRUFBRTtZQUNqQyxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7U0FDeEI7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRU0sR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBa0IsRUFBRTtRQUMxQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLGFBQWEsRUFBRTthQUNqQixNQUFNLENBQUMsQ0FBQyxhQUE0QixFQUFFLEVBQUU7WUFDdkMsT0FBTyxhQUFhLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUE0QixFQUFFLEVBQUU7WUFDMUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN2RixDQUFDLENBQUMsQ0FBQztRQUVMLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFJLEVBQUUsVUFBa0IsRUFBRTtRQUN0QyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLGFBQWEsRUFBRTthQUNqQixNQUFNLENBQUMsQ0FBQyxJQUFtQixFQUFFLEVBQUU7WUFDOUIsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQztRQUM1QixDQUFDLENBQUM7YUFDRCxPQUFPLENBQUMsQ0FBQyxhQUE0QixFQUFFLEVBQUU7WUFDeEMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ25GLENBQUMsQ0FBQyxDQUFDO1FBRUwsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU0sS0FBSztRQUNWLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM3QyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLGFBQWEsQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDekUsQ0FBQyxDQUFDLENBQUM7U0FDSjtRQUNELElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFdEIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU8sYUFBYTtRQUNuQixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQzs7cUdBbEVVLE9BQU87eUdBQVAsT0FBTzs0RkFBUCxPQUFPO2tCQURuQixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBGc1N0b3JlT2JqZWN0IH0gZnJvbSAnLi4vY2xhc3Nlcy9zdG9yZS1vYmplY3QnO1xuaW1wb3J0IHsgU3RvcmVPYnNlcnZlciB9IGZyb20gJy4vLi4vaW50ZXJmYWNlcy9zdG9yZS1vYnNlcnZlcic7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGc1N0b3JlIHtcblxuICBwcml2YXRlIF9zdG9yYWdlOiBhbnkgPSB3aW5kb3cubG9jYWxTdG9yYWdlO1xuICBwcml2YXRlIF9zdG9yZU9ic2VydmVycyA9IFtdO1xuXG4gIHB1YmxpYyBvYnNlcnZlKG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8RnNTdG9yZU9iamVjdD4ge1xuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXI6IE9ic2VydmVyPGFueT4pID0+IHtcbiAgICAgIHRoaXMuX2dldE9ic2VydmVycygpLnB1c2goeyBuYW1lOiBuYW1lLCBvYnNlcnZlcjogb2JzZXJ2ZXIgfSk7XG4gICAgICBvYnNlcnZlci5uZXh0KG5ldyBGc1N0b3JlT2JqZWN0KG5hbWUsIEZzU3RvcmVPYmplY3QuRVZFTlRfSU5JVCwgdGhpcy5nZXQobmFtZSkpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQoa2V5LCBvcHRpb25zOiB7IGRlZmF1bHQ/OiBib29sZWFuIH0gPSB7fSkge1xuXG4gICAgaWYgKHRoaXMuX3N0b3JhZ2UuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5fc3RvcmFnZVtrZXldKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5kZWZhdWx0O1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwdWJsaWMgc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zOiBPYmplY3QgPSB7fSkge1xuICAgIHRoaXMuX3N0b3JhZ2VbbmFtZV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgdGhpcy5fZ2V0T2JzZXJ2ZXJzKClcbiAgICAgIC5maWx0ZXIoKHN0b3JlT2JzZXJ2ZXI6IFN0b3JlT2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgcmV0dXJuIHN0b3JlT2JzZXJ2ZXIubmFtZSA9PT0gbmFtZTtcbiAgICAgIH0pLmZvckVhY2goKHN0b3JlT2JzZXJ2ZXI6IFN0b3JlT2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgc3RvcmVPYnNlcnZlci5vYnNlcnZlci5uZXh0KG5ldyBGc1N0b3JlT2JqZWN0KG5hbWUsIEZzU3RvcmVPYmplY3QuRVZFTlRfU0VULCB2YWx1ZSkpO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmUobmFtZSwgb3B0aW9uczogT2JqZWN0ID0ge30pIHtcbiAgICBkZWxldGUgdGhpcy5fc3RvcmFnZVtuYW1lXTtcbiAgICB0aGlzLl9nZXRPYnNlcnZlcnMoKVxuICAgICAgLmZpbHRlcigoaXRlbTogU3RvcmVPYnNlcnZlcikgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbS5uYW1lID09PSBuYW1lO1xuICAgICAgfSlcbiAgICAgIC5mb3JFYWNoKChzdG9yZU9ic2VydmVyOiBTdG9yZU9ic2VydmVyKSA9PiB7XG4gICAgICAgIHN0b3JlT2JzZXJ2ZXIub2JzZXJ2ZXIubmV4dChuZXcgRnNTdG9yZU9iamVjdChuYW1lLCBGc1N0b3JlT2JqZWN0LkVWRU5UX1JFTU9WRSkpO1xuICAgICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyBjbGVhcigpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3N0b3JhZ2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMuX3N0b3JhZ2Uua2V5KGkpO1xuICAgICAgdGhpcy5fZ2V0T2JzZXJ2ZXJzKCkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5vYnNlcnZlci5uZXh0KG5ldyBGc1N0b3JlT2JqZWN0KGtleSwgRnNTdG9yZU9iamVjdC5FVkVOVF9SRU1PVkUpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLl9zdG9yYWdlLmNsZWFyKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByaXZhdGUgX2dldE9ic2VydmVycygpOiBTdG9yZU9ic2VydmVyW10ge1xuICAgIHJldHVybiB0aGlzLl9zdG9yZU9ic2VydmVycztcbiAgfVxuXG59XG4iXX0=