import { ESCAPE } from '@angular/cdk/keycodes';
import { BehaviorSubject, Observable, Subject, zip } from 'rxjs';
import { filter, take, takeUntil, switchMap, map } from 'rxjs/operators';
import { DrawerConfig } from '../models/drawer-config.model';
export class DrawerRef {
    constructor(_overlayRef, _dataFactory, _config) {
        this._overlayRef = _overlayRef;
        this._dataFactory = _dataFactory;
        /** Subject for notifying the user that the drawer has finished opening. */
        this._afterOpened$ = new Subject();
        /** Subject for notifying the user that the drawer has finished closing. */
        this._afterClosed$ = new Subject();
        /** Subject for notifying the user that the drawer has started closing. */
        this._closeStart$ = new Subject();
        /** Subject for notifying the user that the drawer has started opening. */
        this._openStart$ = new Subject();
        /** Subject for notifying the user that the drawer has started closing. */
        this._sideToggle = new Subject();
        /** Subject for notifying the user that the drawer has finished opening. */
        this._actionsUpdated$ = new Subject();
        /** Destroy notifier **/
        this._destroy$ = new Subject();
        this._activeAction = new BehaviorSubject(void 0);
        this._menuRefs = new Map();
        this._isOpen = false;
        this._isSideOpen = false;
        this.drawerConfig = new DrawerConfig(_config);
        this._initActiveAction();
    }
    get overlayRef() {
        return this._overlayRef;
    }
    /**
     * Getter for DRAWER_DATA for current drawer
     */
    get drawerData() {
        return Object.assign({}, this._dataFactory.getValue()); // Like immutable.... TODO switch to Immer
    }
    get destroy$() {
        return this._destroy$.asObservable();
    }
    /**
     * Set reference to drawer container
     * @param value
     */
    set containerRef(value) {
        this._drawerContainerRef = value;
    }
    /**
     * Set reference to drawer component
     * @param value
     */
    set componentRef(value) {
        this._drawerComponentRef = value;
    }
    set drawerContainer(value) {
        this._drawerContainer = value;
    }
    set drawerActionsContainer(value) {
        this._drawerActionsContainer = value;
    }
    get drawerContainer() {
        return this._drawerContainer;
    }
    get drawerActionsContainer() {
        return this._drawerActionsContainer;
    }
    get activeAction() {
        return this._activeAction.getValue();
    }
    get activeAction$() {
        return this._activeAction.pipe(takeUntil(this._destroy$));
    }
    /**
     * Return actual status of the drawer
     */
    get isOpen() {
        return this._isOpen;
    }
    /**
     * Return actual status of the side of the drawer
     */
    get isSideOpen() {
        return this._isSideOpen;
    }
    set resizeController(value) {
        this._resizeController = value;
    }
    get resizeController() {
        return this._resizeController;
    }
    /**
     * Gets an observable that action was updated and change detection should be started
     */
    get actionUpdated$() {
        return this._actionsUpdated$.pipe(takeUntil(this._destroy$));
    }
    /**
     * Gets an observable that is notified when the dialog is finished closing.
     */
    get afterClosed$() {
        return this._afterClosed$.pipe(takeUntil(this._destroy$));
    }
    /**
     * Gets an observable that is notified when the dialog is finished opening.
     */
    get afterOpened$() {
        return this._afterOpened$.pipe(takeUntil(this._destroy$));
    }
    /**
     * Gets an observable that is notified when the dialog open starts.
     */
    get openStart$() {
        return this._openStart$.pipe(takeUntil(this._destroy$));
    }
    /**
     * Gets an observable that is notified when the dialog is finished opening.
     */
    get closeStart$() {
        return this._closeStart$.pipe(takeUntil(this._destroy$));
    }
    closeWhen() {
        return (source) => {
            this._closeStart$
                .pipe(switchMap((observer) => {
                return source.pipe(map(() => {
                    return observer;
                }));
            }))
                .subscribe((observer) => {
                observer.next();
                observer.complete();
            });
            //   switchMap(() => {
            //     debugger;
            //     return source;
            //   })
            // )
            // .subscribe((observer) => {
            // source.pipe(
            //   tap(() => {
            //     debugger;
            //     observer.next();
            //     observer.complete();
            //   }),
            // );
            return source;
            // return new Observable(subscriber => {
            //   source.subscribe({
            //     next(value) {
            //       if (value !== undefined && value !== null) {
            //         subscriber.next(value);
            //       }
            //     },
            //     error(error) {
            //       subscriber.error(error);
            //     },
            //     complete() {
            //       subscriber.complete();
            //     }
            //   })
            // });
        };
    }
    /**
     * Gets an observable that is notified when data in DRAWER_DATA was changed
     */
    get dataChanged$() {
        return this._dataFactory.dataChange$;
    }
    /**
     * Gets an observable that is notify that side status toggled
     */
    get sideToggle$() {
        return this._sideToggle.pipe(takeUntil(this._destroy$));
    }
    /**
     * Subscribe on keydown events to react on escape
     */
    events() {
        this._overlayRef.keydownEvents()
            .pipe(filter(event => event.keyCode === ESCAPE && !this.drawerConfig.disableClose), takeUntil(this._destroy$))
            .subscribe(() => this.close());
    }
    /**
     * Set value for DRAWER_DATA
     * @param data
     */
    dataChange(data) {
        this._dataFactory.setValue(data);
    }
    /**
     * Open drawer and notify observable
     */
    open() {
        new Observable((obs) => {
            setTimeout(() => {
                if (this._openStart$.observers.length) {
                    this._openStart$.next(obs);
                }
                else {
                    obs.next();
                    obs.complete();
                }
            });
        }).pipe(takeUntil(this._destroy$))
            .subscribe({
            next: () => {
                if (this.activeAction) {
                    this.openSide();
                }
                this._drawerContainerRef.open();
                this._afterOpened$.next();
                this._afterOpened$.complete();
            },
            error: () => {
                this.destroy();
            },
        });
    }
    /**
     * Close the drawer.
     * @param result Optional result to return to the dialog opener.
     */
    close(result) {
        new Observable(observer => {
            if (this._closeStart$.observers.length) {
                zip(...this._closeStart$.observers.map(item => {
                    return Observable.create(closeObserver => {
                        item.next(closeObserver);
                    });
                }))
                    .pipe(takeUntil(this._destroy$))
                    .subscribe(() => {
                    observer.next();
                    observer.complete();
                }, () => {
                    observer.error();
                });
            }
            else {
                observer.next();
                observer.complete();
            }
        }).pipe(takeUntil(this._destroy$))
            .subscribe({
            next: () => {
                this._drawerContainerRef.close();
                this._result = result;
                this._afterClosed$.next(result);
                this.destroy();
            }
        });
    }
    /**
     * Open the side of the drawer
     */
    openSide() {
        this._isSideOpen = true;
        this._sideToggle.next(this._isSideOpen);
    }
    /**
     * Close the side of the drawer
     */
    closeSide() {
        this._isSideOpen = false;
        this._sideToggle.next(this._isSideOpen);
        this.activateAction(null);
    }
    /**
     * Toggle the side of the drawer
     */
    toggleSide() {
        this.isSideOpen ? this.closeSide() : this.openSide();
    }
    /**
     * Change active action
     * @param name
     */
    activateAction(name) {
        this._activeAction.next(name);
        if (name) {
            this.openSide();
        }
    }
    enableAction(name) {
        const action = this.getAction(name);
        if (action) {
            action.disabled = false;
            this._actionsUpdated$.next(name);
        }
    }
    disableAction(name) {
        const action = this.getAction(name);
        if (action) {
            action.disabled = true;
            this._actionsUpdated$.next(name);
        }
    }
    /**
     * Store opened menu reference and subscribe for auto remove
     * @param name
     * @param ref
     */
    addMenuRef(name, ref) {
        this._menuRefs.set(name, ref);
        ref.afterClosed()
            .pipe(take(1), takeUntil(this._destroy$))
            .subscribe(() => {
            this._menuRefs.delete(name);
        });
    }
    /**
     * Get opened menu reference by name
     * @param name
     */
    getMenuRef(name) {
        return this._menuRefs.get(name);
    }
    getAction(name) {
        return this.drawerConfig.actions.find((action) => action.name === name);
    }
    /**
     * Do update for icon for target action
     * @param name
     * @param icon
     */
    updateActionIcon(name, icon) {
        const action = this.getAction(name);
        if (action) {
            action.icon = icon;
            this._actionsUpdated$.next(name);
        }
    }
    /**
     * Do update
     * @param name
     * @param data
     */
    updateAction(name, data) {
        const action = this.getAction(name);
        if (action) {
            const allowedFields = ['icon', 'type', 'toggle', 'tooltip', 'close', 'closeSide', 'component', 'data'];
            const forUpdate = Object.keys(data).filter((key) => allowedFields.indexOf(key) > -1);
            forUpdate.forEach((key) => {
                action[key] = data[key];
            });
            this._actionsUpdated$.next(name);
        }
    }
    updateDrawerWidth(width) {
        this.resizeController.updateMainWidth(width);
    }
    updateSideDrawerWidth(width) {
        this.resizeController.updateSideWidth(width);
    }
    destroy() {
        this._overlayRef.detachBackdrop();
        this._overlayRef.detach();
        this._drawerComponentRef.destroy();
        this._dataFactory.destroy();
        this._destroy$.next();
        this._destroy$.complete();
    }
    _initActiveAction() {
        if (this.drawerConfig.activeAction) {
            const action = this.drawerConfig.actions
                .find((a) => a.name === this.drawerConfig.activeAction);
            if (action) {
                this._activeAction.next(this.drawerConfig.activeAction);
            }
            else {
                console.warn(`Drawer active action - "${this.drawerConfig.activeAction}" does not exists
        `);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLXJlZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvY2xhc3Nlcy9kcmF3ZXItcmVmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUcvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQWMsR0FBRyxFQUFRLE1BQU0sTUFBTSxDQUFDO0FBQ25GLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBTyxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJOUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBTTdELE1BQU0sT0FBTyxTQUFTO0lBa0RwQixZQUNVLFdBQXVCLEVBQ3ZCLFlBQXdCLEVBQ2hDLE9BQXNCO1FBRmQsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUFDdkIsaUJBQVksR0FBWixZQUFZLENBQVk7UUFoRGxDLDJFQUEyRTtRQUMxRCxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFFckQsMkVBQTJFO1FBQzFELGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQWlCLENBQUM7UUFFOUQsMEVBQTBFO1FBQ3pELGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQW9CLENBQUM7UUFFaEUsMEVBQTBFO1FBQ3pELGdCQUFXLEdBQUcsSUFBSSxPQUFPLEVBQW9CLENBQUM7UUFFL0QsMEVBQTBFO1FBQ3pELGdCQUFXLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUV0RCwyRUFBMkU7UUFDMUQscUJBQWdCLEdBQUcsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUUxRCx3QkFBd0I7UUFDUCxjQUFTLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQW1CekMsa0JBQWEsR0FBRyxJQUFJLGVBQWUsQ0FBUyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXBELGNB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ZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFTSxxQkFBcUIsQ0FBQyxLQUFhO1FBQ3hDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVNLE9BQU87UUFDWixJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRTtZQUNsQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU87aUJBQ3JDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTFELElBQUksTUFBTSxFQUFFO2dCQUNWLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDekQ7aUJBQU07Z0JBQ0wsT0FBTyxDQUFDLElBQUksQ0FDViwyQkFBMkIsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZO1NBQzFELENBQUMsQ0FBQzthQUNKO1NBQ0Y7SUFDSCxDQUFDO0NBRUYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEVTQ0FQRSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9rZXljb2Rlcyc7XG5pbXBvcnQgeyBPdmVybGF5UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YmplY3QsIFN1YnNjcmliZXIsIHppcCwgcGlwZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCB0YWtlLCB0YWtlVW50aWwsIHRhcCwgc3dpdGNoTWFwLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IERyYXdlckRhdGEgfSBmcm9tICcuL2RyYXdlci1kYXRhJztcbmltcG9ydCB0eXBlIHsgRnNEcmF3ZXJDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL2RyYXdlci9kcmF3ZXIuY29tcG9uZW50JztcbmltcG9ydCB7IERyYXdlckNvbmZpZyB9IGZyb20gJy4uL21vZGVscy9kcmF3ZXItY29uZmlnLm1vZGVsJztcbmltcG9ydCB7IERyYXdlck1lbnVSZWYgfSBmcm9tICcuLi9jbGFzc2VzL2RyYXdlci1tZW51LXJlZic7XG5pbXBvcnQgeyBJRHJhd2VyQ29uZmlnIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9kcmF3ZXItY29uZmlnLmludGVyZmFjZSc7XG5pbXBvcnQgeyBEcmF3ZXJTaXplQ29udHJvbGxlciB9IGZyb20gJy4vZHJhd2VyLXNpemUtY29udHJvbGxlcic7XG5cblxuZXhwb3J0IGNsYXNzIERyYXdlclJlZjxULCBSID0gYW55PiB7XG5cbiAgcHVibGljIHJlYWRvbmx5IGRyYXdlckNvbmZpZzogRHJhd2VyQ29uZmlnO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBmaW5pc2hlZCBvcGVuaW5nLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlck9wZW5lZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBmaW5pc2hlZCBjbG9zaW5nLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZCQgPSBuZXcgU3ViamVjdDxSIHwgdW5kZWZpbmVkPigpO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBzdGFydGVkIGNsb3NpbmcuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX2Nsb3NlU3RhcnQkID0gbmV3IFN1YmplY3Q8U3Vic2NyaWJlcjx2b2lkPj4oKTtcblxuICAvKiogU3ViamVjdCBmb3Igbm90aWZ5aW5nIHRoZSB1c2VyIHRoYXQgdGhlIGRyYXdlciBoYXMgc3RhcnRlZCBvcGVuaW5nLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9vcGVuU3RhcnQkID0gbmV3IFN1YmplY3Q8U3Vic2NyaWJlcjx2b2lkPj4oKTtcblxuICAvKiogU3ViamVjdCBmb3Igbm90aWZ5aW5nIHRoZSB1c2VyIHRoYXQgdGhlIGRyYXdlciBoYXMgc3RhcnRlZCBjbG9zaW5nLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9zaWRlVG9nZ2xlID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICAvKiogU3ViamVjdCBmb3Igbm90aWZ5aW5nIHRoZSB1c2VyIHRoYXQgdGhlIGRyYXdlciBoYXMgZmluaXNoZWQgb3BlbmluZy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfYWN0aW9uc1VwZGF0ZWQkID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuXG4gIC8qKiBEZXN0cm95IG5vdGlmaWVyICoqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9kZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgLyoqIFJlc3VsdCB0byBiZSBwYXNzZWQgdG8gYWZ0ZXJDbG9zZWQuICovXG4gIHByaXZhdGUgX3Jlc3VsdDogUiB8IHVuZGVmaW5lZDtcblxuICAvKiogTWFpbiBkcmF3ZXIgY29tcG9uZW50IGFuZCB0ZW1wbGF0ZSAqL1xuICBwcml2YXRlIF9kcmF3ZXJDb250YWluZXJSZWY6IEZzRHJhd2VyQ29tcG9uZW50O1xuXG4gIC8qKiBNYWluIGRyYXdlciBjb21wb25lbnQgYW5kIHRlbXBsYXRlICovXG4gIHByaXZhdGUgX2RyYXdlckNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPFQ+O1xuXG4gIC8qKiBEcmF3ZXIgQ29udGVudCBUZW1wbGF0ZSAqL1xuICBwcml2YXRlIF9kcmF3ZXJDb250YWluZXI6IEVsZW1lbnRSZWY7XG5cbiAgLyoqIERyYXdlciBBY3Rpb25zIFRlbXBsYXRlICovXG4gIHByaXZhdGUgX2RyYXdlckFjdGlvbnNDb250YWluZXI6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBfcmVzaXplQ29udHJvbGxlcjogRHJhd2VyU2l6ZUNvbnRyb2xsZXI7XG5cbiAgcHJpdmF0ZSBfYWN0aXZlQWN0aW9uID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHZvaWQgMCk7XG5cbiAgcHJpdmF0ZSBfbWVudVJlZnMgPSBuZXcgTWFwPHN0cmluZywgRHJhd2VyTWVudVJlZjxULCBSPj4oKTtcblxuICBwcml2YXRlIF9pc09wZW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaXNTaWRlT3BlbiA9IGZhbHNlO1xuXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfb3ZlcmxheVJlZjogT3ZlcmxheVJlZixcbiAgICBwcml2YXRlIF9kYXRhRmFjdG9yeTogRHJhd2VyRGF0YSxcbiAgICBfY29uZmlnOiBJRHJhd2VyQ29uZmlnXG4gICkge1xuICAgIHRoaXMuZHJhd2VyQ29uZmlnID0gbmV3IERyYXdlckNvbmZpZyhfY29uZmlnKTtcbiAgICB0aGlzLl9pbml0QWN0aXZlQWN0aW9uKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IG92ZXJsYXlSZWYoKSB7XG4gICAgcmV0dXJuIHRoaXMuX292ZXJsYXlSZWY7XG4gIH1cblxuICAvKipcbiAgICogR2V0dGVyIGZvciBEUkFXRVJfREFUQSBmb3IgY3VycmVudCBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyBnZXQgZHJhd2VyRGF0YSgpIHtcbiAgICByZXR1cm4geyAuLi50aGlzLl9kYXRhRmFjdG9yeS5nZXRWYWx1ZSgpIH0gLy8gTGlrZSBpbW11dGFibGUuLi4uIFRPRE8gc3dpdGNoIHRvIEltbWVyXG4gIH1cblxuICBwdWJsaWMgZ2V0IGRlc3Ryb3kkKCkge1xuICAgIHJldHVybiB0aGlzLl9kZXN0cm95JC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgcmVmZXJlbmNlIHRvIGRyYXdlciBjb250YWluZXJcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqL1xuICBwdWJsaWMgc2V0IGNvbnRhaW5lclJlZih2YWx1ZTogRnNEcmF3ZXJDb21wb25lbnQpIHtcbiAgICB0aGlzLl9kcmF3ZXJDb250YWluZXJSZWYgPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgcmVmZXJlbmNlIHRvIGRyYXdlciBjb21wb25lbnRcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqL1xuICBwdWJsaWMgc2V0IGNvbXBvbmVudFJlZih2YWx1ZTogQ29tcG9uZW50UmVmPFQ+KSB7XG4gICAgdGhpcy5fZHJhd2VyQ29tcG9uZW50UmVmID0gdmFsdWU7XG4gIH1cblxuICBwdWJsaWMgc2V0IGRyYXdlckNvbnRhaW5lcih2YWx1ZTogRWxlbWVudFJlZikge1xuICAgIHRoaXMuX2RyYXdlckNvbnRhaW5lciA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldCBkcmF3ZXJBY3Rpb25zQ29udGFpbmVyKHZhbHVlOiBFbGVtZW50UmVmKSB7XG4gICAgdGhpcy5fZHJhd2VyQWN0aW9uc0NvbnRhaW5lciA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldCBkcmF3ZXJDb250YWluZXIoKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuX2RyYXdlckNvbnRhaW5lcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZHJhd2VyQWN0aW9uc0NvbnRhaW5lcigpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gdGhpcy5fZHJhd2VyQWN0aW9uc0NvbnRhaW5lcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYWN0aXZlQWN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9hY3RpdmVBY3Rpb24uZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYWN0aXZlQWN0aW9uJCgpIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlQWN0aW9uLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGFjdHVhbCBzdGF0dXMgb2YgdGhlIGRyYXdlclxuICAgKi9cbiAgcHVibGljIGdldCBpc09wZW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzT3BlbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWN0dWFsIHN0YXR1cyBvZiB0aGUgc2lkZSBvZiB0aGUgZHJhd2VyXG4gICAqL1xuICBwdWJsaWMgZ2V0IGlzU2lkZU9wZW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzU2lkZU9wZW47XG4gIH1cblxuICBwdWJsaWMgc2V0IHJlc2l6ZUNvbnRyb2xsZXIodmFsdWU6IERyYXdlclNpemVDb250cm9sbGVyKSB7XG4gICAgdGhpcy5fcmVzaXplQ29udHJvbGxlciA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldCByZXNpemVDb250cm9sbGVyKCk6IERyYXdlclNpemVDb250cm9sbGVyIHtcbiAgICByZXR1cm4gdGhpcy5fcmVzaXplQ29udHJvbGxlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBhY3Rpb24gd2FzIHVwZGF0ZWQgYW5kIGNoYW5nZSBkZXRlY3Rpb24gc2hvdWxkIGJlIHN0YXJ0ZWRcbiAgICovXG4gIHB1YmxpYyBnZXQgYWN0aW9uVXBkYXRlZCQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aW9uc1VwZGF0ZWQkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZpZWQgd2hlbiB0aGUgZGlhbG9nIGlzIGZpbmlzaGVkIGNsb3NpbmcuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGFmdGVyQ2xvc2VkJCgpOiBPYnNlcnZhYmxlPFIgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy5fYWZ0ZXJDbG9zZWQkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZpZWQgd2hlbiB0aGUgZGlhbG9nIGlzIGZpbmlzaGVkIG9wZW5pbmcuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGFmdGVyT3BlbmVkJCgpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5fYWZ0ZXJPcGVuZWQkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZpZWQgd2hlbiB0aGUgZGlhbG9nIG9wZW4gc3RhcnRzLlxuICAgKi9cbiAgcHVibGljIGdldCBvcGVuU3RhcnQkKCk6IE9ic2VydmFibGU8U3Vic2NyaWJlcjx2b2lkPj4ge1xuICAgIHJldHVybiB0aGlzLl9vcGVuU3RhcnQkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZpZWQgd2hlbiB0aGUgZGlhbG9nIGlzIGZpbmlzaGVkIG9wZW5pbmcuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGNsb3NlU3RhcnQkKCk6IE9ic2VydmFibGU8U3Vic2NyaWJlcjx2b2lkPj4ge1xuICAgIHJldHVybiB0aGlzLl9jbG9zZVN0YXJ0JC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpO1xuICB9XG5cbiAgcHVibGljIGNsb3NlV2hlbigpOiBhbnkge1xuICAgIHJldHVybiAoc291cmNlOiBPYnNlcnZhYmxlPFQ+KSA9PiB7XG4gICAgICB0aGlzLl9jbG9zZVN0YXJ0JFxuICAgICAgICAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc291cmNlLnBpcGUoXG4gICAgICAgICAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCgpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0pO1xuXG5cblxuICAgICAgICAvLyAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgIC8vICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgLy8gICAgIHJldHVybiBzb3VyY2U7XG4gICAgICAgIC8vICAgfSlcbiAgICAgICAgLy8gKVxuICAgICAgICAvLyAuc3Vic2NyaWJlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAvLyBzb3VyY2UucGlwZShcbiAgICAgICAgLy8gICB0YXAoKCkgPT4ge1xuICAgICAgICAvLyAgICAgZGVidWdnZXI7XG4gICAgICAgIC8vICAgICBvYnNlcnZlci5uZXh0KCk7XG4gICAgICAgIC8vICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAvLyAgIH0pLFxuICAgICAgICAvLyApO1xuXG5cbiAgICByZXR1cm4gc291cmNlO1xuICAgICAgLy8gcmV0dXJuIG5ldyBPYnNlcnZhYmxlKHN1YnNjcmliZXIgPT4ge1xuICAgICAgLy8gICBzb3VyY2Uuc3Vic2NyaWJlKHtcbiAgICAgIC8vICAgICBuZXh0KHZhbHVlKSB7XG4gICAgICAvLyAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgLy8gICAgICAgICBzdWJzY3JpYmVyLm5leHQodmFsdWUpO1xuICAgICAgLy8gICAgICAgfVxuICAgICAgLy8gICAgIH0sXG4gICAgICAvLyAgICAgZXJyb3IoZXJyb3IpIHtcbiAgICAgIC8vICAgICAgIHN1YnNjcmliZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgLy8gICAgIH0sXG4gICAgICAvLyAgICAgY29tcGxldGUoKSB7XG4gICAgICAvLyAgICAgICBzdWJzY3JpYmVyLmNvbXBsZXRlKCk7XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9KVxuICAgICAgLy8gfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYW4gb2JzZXJ2YWJsZSB0aGF0IGlzIG5vdGlmaWVkIHdoZW4gZGF0YSBpbiBEUkFXRVJfREFUQSB3YXMgY2hhbmdlZFxuICAgKi9cbiAgcHVibGljIGdldCBkYXRhQ2hhbmdlZCQoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YUZhY3RvcnkuZGF0YUNoYW5nZSQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZ5IHRoYXQgc2lkZSBzdGF0dXMgdG9nZ2xlZFxuICAgKi9cbiAgcHVibGljIGdldCBzaWRlVG9nZ2xlJCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5fc2lkZVRvZ2dsZS5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN1YnNjcmliZSBvbiBrZXlkb3duIGV2ZW50cyB0byByZWFjdCBvbiBlc2NhcGVcbiAgICovXG4gIHB1YmxpYyBldmVudHMoKSB7XG4gICAgdGhpcy5fb3ZlcmxheVJlZi5rZXlkb3duRXZlbnRzKClcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoZXZlbnQgPT4gZXZlbnQua2V5Q29kZSA9PT0gRVNDQVBFICYmICF0aGlzLmRyYXdlckNvbmZpZy5kaXNhYmxlQ2xvc2UpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB2YWx1ZSBmb3IgRFJBV0VSX0RBVEFcbiAgICogQHBhcmFtIGRhdGFcbiAgICovXG4gIHB1YmxpYyBkYXRhQ2hhbmdlKGRhdGEpIHtcbiAgICB0aGlzLl9kYXRhRmFjdG9yeS5zZXRWYWx1ZShkYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIGRyYXdlciBhbmQgbm90aWZ5IG9ic2VydmFibGVcbiAgICovXG4gIHB1YmxpYyBvcGVuKCkge1xuICAgIG5ldyBPYnNlcnZhYmxlPHZvaWQ+KChvYnMpID0+IHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4geyAvLyBGSVhNRSBDcnV0Y2hcbiAgICAgICAgaWYgKHRoaXMuX29wZW5TdGFydCQub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuX29wZW5TdGFydCQubmV4dChvYnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9icy5uZXh0KCk7XG4gICAgICAgICAgb2JzLmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuYWN0aXZlQWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW5TaWRlKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5fZHJhd2VyQ29udGFpbmVyUmVmLm9wZW4oKTtcbiAgICAgICAgICB0aGlzLl9hZnRlck9wZW5lZCQubmV4dCgpO1xuICAgICAgICAgIHRoaXMuX2FmdGVyT3BlbmVkJC5jb21wbGV0ZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlIHRoZSBkcmF3ZXIuXG4gICAqIEBwYXJhbSByZXN1bHQgT3B0aW9uYWwgcmVzdWx0IHRvIHJldHVybiB0byB0aGUgZGlhbG9nIG9wZW5lci5cbiAgICovXG4gIHB1YmxpYyBjbG9zZShyZXN1bHQ/OiBSKTogdm9pZCB7XG4gICAgbmV3IE9ic2VydmFibGU8dm9pZD4ob2JzZXJ2ZXIgPT4ge1xuICAgICAgaWYgKHRoaXMuX2Nsb3NlU3RhcnQkLm9ic2VydmVycy5sZW5ndGgpIHtcbiAgICAgICAgemlwKC4uLnRoaXMuX2Nsb3NlU3RhcnQkLm9ic2VydmVycy5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKGNsb3NlT2JzZXJ2ZXIgPT4ge1xuICAgICAgICAgICAgaXRlbS5uZXh0KGNsb3NlT2JzZXJ2ZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KSlcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIG9ic2VydmVyLm5leHQoKTtcbiAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYnNlcnZlci5uZXh0KCk7XG4gICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICB9XG5cbiAgICB9KS5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgdGhpcy5fZHJhd2VyQ29udGFpbmVyUmVmLmNsb3NlKCk7XG4gICAgICAgIHRoaXMuX3Jlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgdGhpcy5fYWZ0ZXJDbG9zZWQkLm5leHQocmVzdWx0KTtcbiAgICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogT3BlbiB0aGUgc2lkZSBvZiB0aGUgZHJhd2VyXG4gICAqL1xuICBwdWJsaWMgb3BlblNpZGUoKSB7XG4gICAgdGhpcy5faXNTaWRlT3BlbiA9IHRydWU7XG4gICAgdGhpcy5fc2lkZVRvZ2dsZS5uZXh0KHRoaXMuX2lzU2lkZU9wZW4pO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlIHRoZSBzaWRlIG9mIHRoZSBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyBjbG9zZVNpZGUoKSB7XG4gICAgdGhpcy5faXNTaWRlT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuX3NpZGVUb2dnbGUubmV4dCh0aGlzLl9pc1NpZGVPcGVuKTtcblxuICAgIHRoaXMuYWN0aXZhdGVBY3Rpb24obnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlIHRoZSBzaWRlIG9mIHRoZSBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyB0b2dnbGVTaWRlKCkge1xuICAgIHRoaXMuaXNTaWRlT3BlbiA/IHRoaXMuY2xvc2VTaWRlKCkgOiB0aGlzLm9wZW5TaWRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlIGFjdGl2ZSBhY3Rpb25cbiAgICogQHBhcmFtIG5hbWVcbiAgICovXG4gIHB1YmxpYyBhY3RpdmF0ZUFjdGlvbihuYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9hY3RpdmVBY3Rpb24ubmV4dChuYW1lKTtcblxuICAgIGlmIChuYW1lKSB7XG4gICAgICB0aGlzLm9wZW5TaWRlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGVuYWJsZUFjdGlvbihuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmdldEFjdGlvbihuYW1lKTtcblxuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIGFjdGlvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5fYWN0aW9uc1VwZGF0ZWQkLm5leHQobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRpc2FibGVBY3Rpb24obmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy5nZXRBY3Rpb24obmFtZSk7XG5cbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICBhY3Rpb24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5fYWN0aW9uc1VwZGF0ZWQkLm5leHQobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIG9wZW5lZCBtZW51IHJlZmVyZW5jZSBhbmQgc3Vic2NyaWJlIGZvciBhdXRvIHJlbW92ZVxuICAgKiBAcGFyYW0gbmFtZVxuICAgKiBAcGFyYW0gcmVmXG4gICAqL1xuICBwdWJsaWMgYWRkTWVudVJlZihuYW1lOiBzdHJpbmcsIHJlZjogRHJhd2VyTWVudVJlZjxULCBSPikge1xuICAgIHRoaXMuX21lbnVSZWZzLnNldChuYW1lLCByZWYpO1xuXG4gICAgcmVmLmFmdGVyQ2xvc2VkKClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5fbWVudVJlZnMuZGVsZXRlKG5hbWUpO1xuICAgICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgb3BlbmVkIG1lbnUgcmVmZXJlbmNlIGJ5IG5hbWVcbiAgICogQHBhcmFtIG5hbWVcbiAgICovXG4gIHB1YmxpYyBnZXRNZW51UmVmKG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9tZW51UmVmcy5nZXQobmFtZSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0QWN0aW9uKG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRyYXdlckNvbmZpZy5hY3Rpb25zLmZpbmQoKGFjdGlvbikgPT4gYWN0aW9uLm5hbWUgPT09IG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIERvIHVwZGF0ZSBmb3IgaWNvbiBmb3IgdGFyZ2V0IGFjdGlvblxuICAgKiBAcGFyYW0gbmFtZVxuICAgKiBAcGFyYW0gaWNvblxuICAgKi9cbiAgcHVibGljIHVwZGF0ZUFjdGlvbkljb24obmFtZTogc3RyaW5nLCBpY29uOiBzdHJpbmcpIHtcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmdldEFjdGlvbihuYW1lKTtcblxuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIGFjdGlvbi5pY29uID0gaWNvbjtcblxuICAgICAgdGhpcy5fYWN0aW9uc1VwZGF0ZWQkLm5leHQobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERvIHVwZGF0ZVxuICAgKiBAcGFyYW0gbmFtZVxuICAgKiBAcGFyYW0gZGF0YVxuICAgKi9cbiAgcHVibGljIHVwZGF0ZUFjdGlvbihuYW1lOiBzdHJpbmcsIGRhdGEpIHtcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmdldEFjdGlvbihuYW1lKTtcblxuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgIGNvbnN0IGFsbG93ZWRGaWVsZHMgPSBbJ2ljb24nLCAndHlwZScsICd0b2dnbGUnLCAndG9vbHRpcCcsICdjbG9zZScsICdjbG9zZVNpZGUnLCAnY29tcG9uZW50JywgJ2RhdGEnXTtcblxuICAgICAgY29uc3QgZm9yVXBkYXRlID0gT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKChrZXkpID0+IGFsbG93ZWRGaWVsZHMuaW5kZXhPZihrZXkpID4gLTEpO1xuXG4gICAgICBmb3JVcGRhdGUuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIGFjdGlvbltrZXldID0gZGF0YVtrZXldO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX2FjdGlvbnNVcGRhdGVkJC5uZXh0KG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVEcmF3ZXJXaWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5yZXNpemVDb250cm9sbGVyLnVwZGF0ZU1haW5XaWR0aCh3aWR0aCk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlU2lkZURyYXdlcldpZHRoKHdpZHRoOiBudW1iZXIpIHtcbiAgICB0aGlzLnJlc2l6ZUNvbnRyb2xsZXIudXBkYXRlU2lkZVdpZHRoKHdpZHRoKTtcbiAgfVxuXG4gIHB1YmxpYyBkZXN0cm95KCkge1xuICAgIHRoaXMuX292ZXJsYXlSZWYuZGV0YWNoQmFja2Ryb3AoKTtcbiAgICB0aGlzLl9vdmVybGF5UmVmLmRldGFjaCgpO1xuICAgIHRoaXMuX2RyYXdlckNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgdGhpcy5fZGF0YUZhY3RvcnkuZGVzdHJveSgpO1xuXG4gICAgdGhpcy5fZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBwcml2YXRlIF9pbml0QWN0aXZlQWN0aW9uKCkge1xuICAgIGlmICh0aGlzLmRyYXdlckNvbmZpZy5hY3RpdmVBY3Rpb24pIHtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuZHJhd2VyQ29uZmlnLmFjdGlvbnNcbiAgICAgICAgLmZpbmQoKGEpID0+IGEubmFtZSA9PT0gdGhpcy5kcmF3ZXJDb25maWcuYWN0aXZlQWN0aW9uKTtcblxuICAgICAgaWYgKGFjdGlvbikge1xuICAgICAgICB0aGlzLl9hY3RpdmVBY3Rpb24ubmV4dCh0aGlzLmRyYXdlckNvbmZpZy5hY3RpdmVBY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIGBEcmF3ZXIgYWN0aXZlIGFjdGlvbiAtIFwiJHt0aGlzLmRyYXdlckNvbmZpZy5hY3RpdmVBY3Rpb259XCIgZG9lcyBub3QgZXhpc3RzXG4gICAgICAgIGApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG59XG5cbiJdfQ==