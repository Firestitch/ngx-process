import { Directive, ElementRef, Input, NgZone, Renderer2, } from '@angular/core';
import { BehaviorSubject, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { DrawerSizeController } from '../classes/drawer-size-controller';
import { DrawerRef } from '../classes/drawer-ref';
import { MAIN_RESIZE_ACTION_BAR_WIDTH, SIDE_RESIZE_BAR_WIDTH } from '../consts/sizes.cont';
import * as i0 from "@angular/core";
import * as i1 from "../classes/drawer-ref";
export class FsDrawerResizerDirective {
    constructor(_el, _renderer, _ngZone, _drawerRef) {
        this._el = _el;
        this._renderer = _renderer;
        this._ngZone = _ngZone;
        this._drawerRef = _drawerRef;
        this.fsDrawerResizer = this._el.nativeElement;
        this.direction = 'left';
        this.resizable = true;
        this._dragStartHandler = this._dragStart.bind(this);
        this._dragHandler = this._drag.bind(this);
        this._dragEndHandler = this._dragEnd.bind(this);
        this._x = 0;
        this._width$ = new BehaviorSubject(0);
        this._actionsWidth = 0;
        this._destroy$ = new Subject();
    }
    get drawerRef() {
        return this._drawerRef;
    }
    get isMainDrawer() {
        return this.type === 'main';
    }
    get isSideDrawer() {
        return this.type === 'side';
    }
    get width() {
        return this._width$.getValue();
    }
    get width$() {
        return this._width$.pipe(takeUntil(this._destroy$));
    }
    get minWidth() {
        const minWidth = this.sizeController.getMinWidth(this.type);
        if (minWidth && minWidth >= 0) {
            const screenWidth = this.sizeController.screenWidth;
            const barWidth = this.barWidth;
            if (screenWidth - minWidth < barWidth) {
                return this.sizeController.screenWidth - barWidth;
            }
            else {
                return minWidth;
            }
        }
    }
    get maxWidth() {
        const maxWidth = this.sizeController.getMaxWidth(this.type);
        let parentContainerWidth = null;
        if (this.parentContainer) {
            parentContainerWidth = this._getElementWidth(this.parentContainer.nativeElement);
        }
        if (parentContainerWidth !== null) {
            return !maxWidth || maxWidth >= parentContainerWidth
                ? parentContainerWidth - this._actionsWidth * 2
                : maxWidth;
        }
        else {
            return !maxWidth || maxWidth >= this.sizeController.screenWidth
                ? this.sizeController.screenWidth
                : maxWidth;
        }
    }
    get barWidth() {
        return this.isMainDrawer
            ? MAIN_RESIZE_ACTION_BAR_WIDTH
            : SIDE_RESIZE_BAR_WIDTH;
    }
    ngOnInit() {
        this.sizeController.registerElRef(this);
        if (this.resizable) {
            this._ngZone.runOutsideAngular(() => {
                this._el.nativeElement.addEventListener('mousedown', this._dragStartHandler, false);
                this._el.nativeElement.addEventListener('touchstart', this._dragStartHandler, false);
            });
            if (this.actionsContainer) {
                this._actionsWidth = this._getElementWidth(this.actionsContainer.nativeElement);
            }
            this.setMinMaxStyles();
            const minWidth = this.sizeController.getMinWidth(this.type);
            let width = this.sizeController.getInitialWidth(this.type)
                || this._getElementWidth(this.fsDrawerResizer);
            if (width < minWidth) {
                width = minWidth;
            }
            this.updateWidth(width);
        }
    }
    updateWidth(width) {
        const minConfiguredWidth = this.sizeController.getMinWidth(this.type);
        const maxConfiguredWidth = this.sizeController.getMaxWidth(this.type);
        const availableWidth = this.sizeController.screenWidth;
        // newWidth should not be
        // greater than maxConfiguredWidth
        // and not lesser than minConfiguredWidth
        width = Math.max(minConfiguredWidth, Math.min(width, maxConfiguredWidth));
        // and sure it shouldn't be greater than screen width
        width = Math.min(width, availableWidth);
        if (width === this.width) {
            return;
        }
        this._width$.next(width);
        requestAnimationFrame(() => {
            this._renderer.setStyle(this.fsDrawerResizer, 'width', `${width}px`);
        });
    }
    ngOnDestroy() {
        this._el.nativeElement.removeEventListener('mousedown', this._dragStartHandler, false);
        this._el.nativeElement.removeEventListener('touchstart', this._dragStartHandler, false);
        this.sizeController.removeElRef(this);
        this._destroy$.next();
        this._destroy$.complete();
    }
    /**
     * Set inline styles min/max width
     */
    setMinMaxStyles() {
        requestAnimationFrame(() => {
            this._renderer.setStyle(this.fsDrawerResizer, 'min-width', `${this.minWidth}px`);
            this._renderer.setStyle(this.fsDrawerResizer, 'max-width', `${this.maxWidth}px`);
        });
    }
    /**
     * Subscribe to move events and init base dimensions/restrictions
     * @param event { MouseEvent }
     */
    _dragStart(event) {
        this._x = this._getClientX(event);
        this.updateWidth(this._getElementWidth(this.fsDrawerResizer));
        this.setMinMaxStyles();
        document.addEventListener('touchmove', this._dragHandler, false);
        document.addEventListener('touchend', this._dragEndHandler, false);
        document.addEventListener('mousemove', this._dragHandler, false);
        document.addEventListener('mouseup', this._dragEndHandler, false);
    }
    /**
     * Update coordinates during drag
     * @param event
     */
    _drag(event) {
        const clientX = this._getClientX(event);
        const predictedWidth = this._calcWidth(this.direction, clientX);
        this._updatePosition(clientX, predictedWidth);
        // this._emitResizeEvent();
    }
    /**
     * Remove listeners when drag finished
     * @param event
     */
    _dragEnd(event) {
        document.removeEventListener('mousemove', this._dragHandler, false);
        document.removeEventListener('mouseup', this._dragEndHandler, false);
        document.removeEventListener('touchmove', this._dragHandler, false);
        document.removeEventListener('touchend', this._dragEndHandler, false);
    }
    /**
     *
     * @param event
     */
    _getClientX(event) {
        return event.touches ? event.touches[0].clientX : event.clientX;
    }
    /**
     * Will return width of element
     * @param el
     */
    _getElementWidth(el) {
        return el.getBoundingClientRect().width;
    }
    /**
     * Update width and position of target element
     * @param clientX
     * @param width
     */
    _updatePosition(clientX, width) {
        this._x = clientX;
        this.updateWidth(width < 0 ? 0 : width);
    }
    /**
     * Calc new width based on offset from previous position
     * @param direction
     * @param clientX
     */
    _calcWidth(direction, clientX) {
        const directionSign = direction === 'left' ? -1 : 1;
        return this.width + (this._x - clientX) * directionSign;
    }
}
FsDrawerResizerDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDrawerResizerDirective, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i0.NgZone }, { token: i1.DrawerRef }], target: i0.ɵɵFactoryTarget.Directive });
FsDrawerResizerDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: FsDrawerResizerDirective, selector: "[fsDrawerResizer]", inputs: { fsDrawerResizer: "fsDrawerResizer", type: "type", direction: "direction", resizable: "resizable", parentContainer: "parentContainer", actionsContainer: "actionsContainer", sizeController: "sizeController" }, host: { properties: { "style.cursor": "\"col-resize\"" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDrawerResizerDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[fsDrawerResizer]',
                    host: {
                        '[style.cursor]': '"col-resize"',
                    }
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i0.NgZone }, { type: i1.DrawerRef }]; }, propDecorators: { fsDrawerResizer: [{
                type: Input
            }], type: [{
                type: Input
            }], direction: [{
                type: Input
            }], resizable: [{
                type: Input
            }], parentContainer: [{
                type: Input
            }], actionsContainer: [{
                type: Input
            }], sizeController: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLXJlc2l6ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2FwcC9kaXJlY3RpdmVzL2RyYXdlci1yZXNpemVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUdOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZUFBZSxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7QUFTM0YsTUFBTSxPQUFPLHdCQUF3QjtJQW9CbkMsWUFDVSxHQUFlLEVBQ2YsU0FBb0IsRUFDcEIsT0FBZSxFQUNmLFVBQTBCO1FBSDFCLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFDZixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFDZixlQUFVLEdBQVYsVUFBVSxDQUFnQjtRQXRCcEIsb0JBQWUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQztRQUV6QyxjQUFTLEdBQUcsTUFBTSxDQUFDO1FBQ25CLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFLekIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsaUJBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxvQkFBZSxHQUFH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QUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxhQUFhLENBQUM7SUFDMUQsQ0FBQzs7c0hBM09VLHdCQUF3QjswR0FBeEIsd0JBQXdCOzRGQUF4Qix3QkFBd0I7a0JBTnBDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtvQkFDN0IsSUFBSSxFQUFFO3dCQUNKLGdCQUFnQixFQUFFLGNBQWM7cUJBQ2pDO2lCQUNGO3NLQUdpQixlQUFlO3NCQUE5QixLQUFLO2dCQUNVLElBQUk7c0JBQW5CLEtBQUs7Z0JBQ1UsU0FBUztzQkFBeEIsS0FBSztnQkFDVSxTQUFTO3NCQUF4QixLQUFLO2dCQUNVLGVBQWU7c0JBQTlCLEtBQUs7Z0JBQ1UsZ0JBQWdCO3NCQUEvQixLQUFLO2dCQUNVLGNBQWM7c0JBQTdCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IERyYXdlclNpemVDb250cm9sbGVyIH0gZnJvbSAnLi4vY2xhc3Nlcy9kcmF3ZXItc2l6ZS1jb250cm9sbGVyJztcbmltcG9ydCB7IERyYXdlclJlZiB9IGZyb20gJy4uL2NsYXNzZXMvZHJhd2VyLXJlZic7XG5pbXBvcnQgeyBNQUlOX1JFU0laRV9BQ1RJT05fQkFSX1dJRFRILCBTSURFX1JFU0laRV9CQVJfV0lEVEggfSBmcm9tICcuLi9jb25zdHMvc2l6ZXMuY29udCc7XG5cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2ZzRHJhd2VyUmVzaXplcl0nLFxuICBob3N0OiB7XG4gICAgJ1tzdHlsZS5jdXJzb3JdJzogJ1wiY29sLXJlc2l6ZVwiJyxcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBGc0RyYXdlclJlc2l6ZXJEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgQElucHV0KCkgcHVibGljIGZzRHJhd2VyUmVzaXplciA9IHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQ7XG4gIEBJbnB1dCgpIHB1YmxpYyB0eXBlOiAnbWFpbicgfCAnc2lkZSc7XG4gIEBJbnB1dCgpIHB1YmxpYyBkaXJlY3Rpb24gPSAnbGVmdCc7XG4gIEBJbnB1dCgpIHB1YmxpYyByZXNpemFibGUgPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgcGFyZW50Q29udGFpbmVyOiBFbGVtZW50UmVmO1xuICBASW5wdXQoKSBwdWJsaWMgYWN0aW9uc0NvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQElucHV0KCkgcHVibGljIHNpemVDb250cm9sbGVyOiBEcmF3ZXJTaXplQ29udHJvbGxlcjtcblxuICBwcml2YXRlIF9kcmFnU3RhcnRIYW5kbGVyID0gdGhpcy5fZHJhZ1N0YXJ0LmJpbmQodGhpcyk7XG4gIHByaXZhdGUgX2RyYWdIYW5kbGVyID0gdGhpcy5fZHJhZy5iaW5kKHRoaXMpO1xuICBwcml2YXRlIF9kcmFnRW5kSGFuZGxlciA9IHRoaXMuX2RyYWdFbmQuYmluZCh0aGlzKTtcblxuICBwcml2YXRlIF94ID0gMDtcbiAgcHJpdmF0ZSBfd2lkdGgkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxudW1iZXI+KDApO1xuICBwcml2YXRlIF9hY3Rpb25zV2lkdGggPSAwO1xuXG4gIHByaXZhdGUgX2Rlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9lbDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgX2RyYXdlclJlZjogRHJhd2VyUmVmPGFueT4sXG4gICkge31cblxuICBwdWJsaWMgZ2V0IGRyYXdlclJlZigpOiBEcmF3ZXJSZWY8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuX2RyYXdlclJlZjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNNYWluRHJhd2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdtYWluJztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNTaWRlRHJhd2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdzaWRlJztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgd2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fd2lkdGgkLmdldFZhbHVlKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHdpZHRoJCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLl93aWR0aCQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG1pbldpZHRoKCk6IG51bWJlciB7XG4gICAgY29uc3QgbWluV2lkdGggPSB0aGlzLnNpemVDb250cm9sbGVyLmdldE1pbldpZHRoKHRoaXMudHlwZSk7XG5cbiAgICBpZiAobWluV2lkdGggJiYgbWluV2lkdGggPj0gMCkge1xuICAgICAgY29uc3Qgc2NyZWVuV2lkdGggPSB0aGlzLnNpemVDb250cm9sbGVyLnNjcmVlbldpZHRoO1xuICAgICAgY29uc3QgYmFyV2lkdGggPSB0aGlzLmJhcldpZHRoO1xuXG4gICAgICBpZiAoc2NyZWVuV2lkdGggLSBtaW5XaWR0aCA8IGJhcldpZHRoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNpemVDb250cm9sbGVyLnNjcmVlbldpZHRoIC0gYmFyV2lkdGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbWluV2lkdGg7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXQgbWF4V2lkdGgoKTogbnVtYmVyIHtcbiAgICBjb25zdCBtYXhXaWR0aCA9IHRoaXMuc2l6ZUNvbnRyb2xsZXIuZ2V0TWF4V2lkdGgodGhpcy50eXBlKTtcbiAgICBsZXQgcGFyZW50Q29udGFpbmVyV2lkdGggPSBudWxsO1xuXG4gICAgaWYgKHRoaXMucGFyZW50Q29udGFpbmVyKSB7XG4gICAgICBwYXJlbnRDb250YWluZXJXaWR0aCA9IHRoaXMuX2dldEVsZW1lbnRXaWR0aCh0aGlzLnBhcmVudENvbnRhaW5lci5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG5cbiAgICBpZiAocGFyZW50Q29udGFpbmVyV2lkdGggIT09IG51bGwpIHtcbiAgICAgIHJldHVybiAhbWF4V2lkdGggfHwgbWF4V2lkdGggPj0gcGFyZW50Q29udGFpbmVyV2lkdGhcbiAgICAgICAgPyBwYXJlbnRDb250YWluZXJXaWR0aCAtIHRoaXMuX2FjdGlvbnNXaWR0aCAqIDJcbiAgICAgICAgOiBtYXhXaWR0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICFtYXhXaWR0aCB8fCBtYXhXaWR0aCA+PSB0aGlzLnNpemVDb250cm9sbGVyLnNjcmVlbldpZHRoXG4gICAgICAgID8gdGhpcy5zaXplQ29udHJvbGxlci5zY3JlZW5XaWR0aFxuICAgICAgICA6IG1heFdpZHRoO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgYmFyV2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pc01haW5EcmF3ZXJcbiAgICAgID8gTUFJTl9SRVNJWkVfQUNUSU9OX0JBUl9XSURUSFxuICAgICAgOiBTSURFX1JFU0laRV9CQVJfV0lEVEg7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG5cbiAgICB0aGlzLnNpemVDb250cm9sbGVyLnJlZ2lzdGVyRWxSZWYodGhpcyk7XG5cbiAgICBpZiAodGhpcy5yZXNpemFibGUpIHtcbiAgICAgIHRoaXMuX25nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fZHJhZ1N0YXJ0SGFuZGxlciwgZmFsc2UpO1xuICAgICAgICB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLl9kcmFnU3RhcnRIYW5kbGVyLCBmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMuYWN0aW9uc0NvbnRhaW5lcikge1xuICAgICAgICB0aGlzLl9hY3Rpb25zV2lkdGggPSB0aGlzLl9nZXRFbGVtZW50V2lkdGgodGhpcy5hY3Rpb25zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpXG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2V0TWluTWF4U3R5bGVzKCk7XG5cbiAgICAgIGNvbnN0IG1pbldpZHRoID0gdGhpcy5zaXplQ29udHJvbGxlci5nZXRNaW5XaWR0aCh0aGlzLnR5cGUpO1xuICAgICAgbGV0IHdpZHRoID0gdGhpcy5zaXplQ29udHJvbGxlci5nZXRJbml0aWFsV2lkdGgodGhpcy50eXBlKVxuICAgICAgICB8fCB0aGlzLl9nZXRFbGVtZW50V2lkdGgodGhpcy5mc0RyYXdlclJlc2l6ZXIpO1xuXG4gICAgICBpZiAod2lkdGggPCBtaW5XaWR0aCkge1xuICAgICAgICB3aWR0aCA9IG1pbldpZHRoO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZVdpZHRoKHdpZHRoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlV2lkdGgod2lkdGgpIHtcbiAgICBjb25zdCBtaW5Db25maWd1cmVkV2lkdGggPSB0aGlzLnNpemVDb250cm9sbGVyLmdldE1pbldpZHRoKHRoaXMudHlwZSk7XG4gICAgY29uc3QgbWF4Q29uZmlndXJlZFdpZHRoID0gdGhpcy5zaXplQ29udHJvbGxlci5nZXRNYXhXaWR0aCh0aGlzLnR5cGUpO1xuICAgIGNvbnN0IGF2YWlsYWJsZVdpZHRoID0gdGhpcy5zaXplQ29udHJvbGxlci5zY3JlZW5XaWR0aDtcblxuICAgIC8vIG5ld1dpZHRoIHNob3VsZCBub3QgYmVcbiAgICAvLyBncmVhdGVyIHRoYW4gbWF4Q29uZmlndXJlZFdpZHRoXG4gICAgLy8gYW5kIG5vdCBsZXNzZXIgdGhhbiBtaW5Db25maWd1cmVkV2lkdGhcbiAgICB3aWR0aCA9IE1hdGgubWF4KG1pbkNvbmZpZ3VyZWRXaWR0aCwgTWF0aC5taW4od2lkdGgsIG1heENvbmZpZ3VyZWRXaWR0aCkpO1xuICAgIC8vIGFuZCBzdXJlIGl0IHNob3VsZG4ndCBiZSBncmVhdGVyIHRoYW4gc2NyZWVuIHdpZHRoXG4gICAgd2lkdGggPSBNYXRoLm1pbih3aWR0aCwgYXZhaWxhYmxlV2lkdGgpO1xuXG4gICAgaWYgKHdpZHRoID09PSB0aGlzLndpZHRoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fd2lkdGgkLm5leHQod2lkdGgpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuZnNEcmF3ZXJSZXNpemVyLCAnd2lkdGgnLCBgJHt3aWR0aH1weGApO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fZHJhZ1N0YXJ0SGFuZGxlciwgZmFsc2UpO1xuICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMuX2RyYWdTdGFydEhhbmRsZXIsIGZhbHNlKTtcblxuICAgIHRoaXMuc2l6ZUNvbnRyb2xsZXIucmVtb3ZlRWxSZWYodGhpcyk7XG5cbiAgICB0aGlzLl9kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5fZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgaW5saW5lIHN0eWxlcyBtaW4vbWF4IHdpZHRoXG4gICAqL1xuICBwdWJsaWMgc2V0TWluTWF4U3R5bGVzKCkge1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmZzRHJhd2VyUmVzaXplciwgJ21pbi13aWR0aCcsIGAke3RoaXMubWluV2lkdGh9cHhgKTtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuZnNEcmF3ZXJSZXNpemVyLCAnbWF4LXdpZHRoJywgYCR7dGhpcy5tYXhXaWR0aH1weGApXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3Vic2NyaWJlIHRvIG1vdmUgZXZlbnRzIGFuZCBpbml0IGJhc2UgZGltZW5zaW9ucy9yZXN0cmljdGlvbnNcbiAgICogQHBhcmFtIGV2ZW50IHsgTW91c2VFdmVudCB9XG4gICAqL1xuICBwcml2YXRlIF9kcmFnU3RhcnQoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcblxuICAgIHRoaXMuX3ggPSB0aGlzLl9nZXRDbGllbnRYKGV2ZW50KTtcbiAgICB0aGlzLnVwZGF0ZVdpZHRoKHRoaXMuX2dldEVsZW1lbnRXaWR0aCh0aGlzLmZzRHJhd2VyUmVzaXplcikpXG5cbiAgICB0aGlzLnNldE1pbk1heFN0eWxlcygpO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5fZHJhZ0hhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMuX2RyYWdFbmRIYW5kbGVyLCBmYWxzZSk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9kcmFnSGFuZGxlciwgZmFsc2UpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9kcmFnRW5kSGFuZGxlciwgZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBjb29yZGluYXRlcyBkdXJpbmcgZHJhZ1xuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHByaXZhdGUgX2RyYWcoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBjbGllbnRYID0gdGhpcy5fZ2V0Q2xpZW50WChldmVudCk7XG5cbiAgICBjb25zdCBwcmVkaWN0ZWRXaWR0aCA9IHRoaXMuX2NhbGNXaWR0aCh0aGlzLmRpcmVjdGlvbiwgY2xpZW50WCk7XG5cbiAgICB0aGlzLl91cGRhdGVQb3NpdGlvbihjbGllbnRYLCBwcmVkaWN0ZWRXaWR0aCk7XG4gICAgLy8gdGhpcy5fZW1pdFJlc2l6ZUV2ZW50KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGxpc3RlbmVycyB3aGVuIGRyYWcgZmluaXNoZWRcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqL1xuICBwcml2YXRlIF9kcmFnRW5kKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fZHJhZ0hhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fZHJhZ0VuZEhhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLl9kcmFnSGFuZGxlciwgZmFsc2UpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fZHJhZ0VuZEhhbmRsZXIsIGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHByaXZhdGUgX2dldENsaWVudFgoZXZlbnQpIHtcbiAgICByZXR1cm4gZXZlbnQudG91Y2hlcyA/IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCA6IGV2ZW50LmNsaWVudFg7XG4gIH1cblxuICAvKipcbiAgICogV2lsbCByZXR1cm4gd2lkdGggb2YgZWxlbWVudFxuICAgKiBAcGFyYW0gZWxcbiAgICovXG4gIHByaXZhdGUgX2dldEVsZW1lbnRXaWR0aChlbCkge1xuICAgIHJldHVybiBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgd2lkdGggYW5kIHBvc2l0aW9uIG9mIHRhcmdldCBlbGVtZW50XG4gICAqIEBwYXJhbSBjbGllbnRYXG4gICAqIEBwYXJhbSB3aWR0aFxuICAgKi9cbiAgcHJpdmF0ZSBfdXBkYXRlUG9zaXRpb24oY2xpZW50WDogbnVtYmVyLCB3aWR0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5feCA9IGNsaWVudFg7XG4gICAgdGhpcy51cGRhdGVXaWR0aCh3aWR0aCA8IDAgPyAwIDogd2lkdGgpXG4gIH1cblxuICAvKipcbiAgICogQ2FsYyBuZXcgd2lkdGggYmFzZWQgb24gb2Zmc2V0IGZyb20gcHJldmlvdXMgcG9zaXRpb25cbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcGFyYW0gY2xpZW50WFxuICAgKi9cbiAgcHJpdmF0ZSBfY2FsY1dpZHRoKGRpcmVjdGlvbiwgY2xpZW50WCkge1xuICAgIGNvbnN0IGRpcmVjdGlvblNpZ24gPSBkaXJlY3Rpb24gPT09ICdsZWZ0JyA/IC0xIDogMTtcblxuICAgIHJldHVybiB0aGlzLndpZHRoICsgKHRoaXMuX3ggLSBjbGllbnRYKSAqIGRpcmVjdGlvblNpZ247XG4gIH1cblxuICAvLyAvKipcbiAgLy8gICogUmVzaXplIGV2ZW50IGZvciBXaW5kb3dcbiAgLy8gICovXG4gIC8vIHByaXZhdGUgX2VtaXRSZXNpemVFdmVudCgpIHtcbiAgLy8gICBjb25zdCByZXNpemVFdmVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFdmVudCgnVUlFdmVudHMnKTtcbiAgLy8gICByZXNpemVFdmVudC5pbml0RXZlbnQoJ3Jlc2l6ZScsIHRydWUsIGZhbHNlKTtcbiAgLy9cbiAgLy8gICB3aW5kb3cuZGlzcGF0Y2hFdmVudChyZXNpemVFdmVudCk7XG4gIC8vIH1cbn1cbiJdfQ==