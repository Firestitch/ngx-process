import { __decorate, __metadata } from "tslib";
import { ElementRef, Injectable, Injector } from '@angular/core';
import { ConnectedPosition, Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';
import { ComponentPortal, PortalInjector } from '@angular/cdk/portal';
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';
import { FsDrawerMenuComponent } from '../components/drawer-menu/drawer-menu.component';
import { DrawerMenuRef } from '../classes/drawer-menu-ref';
import { DrawerData } from '../classes/drawer-data';
import { DRAWER_MENU_DATA } from '../services/drawer-menu-data';
let FsDrawerMenuService = class FsDrawerMenuService {
    constructor(_overlay, _injector, _breakpointObserver) {
        this._overlay = _overlay;
        this._injector = _injector;
        this._breakpointObserver = _breakpointObserver;
    }
    create(component, container, config) {
        const overlayRef = this.createOverlay(container);
        const dataFactory = DrawerData.createWithProxy(config.data);
        const menuRef = new DrawerMenuRef(overlayRef, dataFactory);
        const containerRef = this.attachContainer(overlayRef, menuRef, dataFactory);
        const componentRef = this.attachComponent(component, containerRef, menuRef, dataFactory);
        menuRef.containerRef = containerRef;
        containerRef.setDrawerMenuRef(menuRef);
        menuRef.componentRef = componentRef;
        return menuRef;
    }
    createOverlay(container) {
        const overlayConfig = this.getOverlayConfig(container);
        return this._overlay.create(overlayConfig);
    }
    getOverlayConfig(container) {
        const element = new ElementRef(container); // positionStrategy needs ElementRef;
        let strategy = null;
        if (this._breakpointObserver.isMatched(Breakpoints.XSmall)) {
            strategy = this._overlay
                .position()
                .global()
                .centerHorizontally()
                .centerVertically();
        }
        else {
            const positions = [
                { originX: 'start', originY: 'bottom', overlayX: 'start', overlayY: 'top' }
            ];
            strategy = this._overlay
                .position()
                .flexibleConnectedTo(element)
                .withPositions(positions);
        }
        return new OverlayConfig({
            positionStrategy: strategy,
            scrollStrategy: this._overlay.scrollStrategies.reposition(),
            hasBackdrop: true,
            backdropClass: 'cdk-overlay-transparent-backdrop'
        });
    }
    attachContainer(overlayRef, menuRef, dataFactory) {
        const injector = this.createInjector(menuRef, dataFactory);
        const containerPortal = new ComponentPortal(FsDrawerMenuComponent, undefined, injector);
        const containerRef = overlayRef.attach(containerPortal);
        return containerRef.instance;
    }
    attachComponent(componentRef, externalContainer, externalRef, config) {
        const injector = this.createInjector(externalRef, config);
        return externalContainer.attachComponentPortal(new ComponentPortal(componentRef, undefined, injector));
    }
    createInjector(componentRef, dataFactory) {
        const injectionTokens = new WeakMap([
            [DrawerMenuRef, componentRef],
            [DRAWER_MENU_DATA, dataFactory]
        ]);
        return new PortalInjector(this._injector, injectionTokens);
    }
};
FsDrawerMenuService.ctorParameters = () => [
    { type: Overlay },
    { type: Injector },
    { type: BreakpointObserver }
];
FsDrawerMenuService = __decorate([
    Injectable(),
    __metadata("design:paramtypes", [Overlay,
        Injector,
        BreakpointObserver])
], FsDrawerMenuService);
export { FsDrawerMenuService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLW1lbnUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXJlc3RpdGNoL2RyYXdlci8iLCJzb3VyY2VzIjpbImFwcC9zZXJ2aWNlcy9kcmF3ZXItbWVudS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDL0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0YsT0FBTyxFQUFFLGVBQWUsRUFBaUIsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXRFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQ3hGLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFJaEUsSUFBYSxtQkFBbUIsR0FBaEMsTUFBYSxtQkFBbUI7SUFFOUIsWUFBb0IsUUFBaUIsRUFDakIsU0FBbUIsRUFDbkIsbUJBQXVDO1FBRnZDLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIsY0FBUyxHQUFULFNBQVMsQ0FBVTtRQUNuQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW9CO0lBQzNELENBQUM7SUFFTSxNQUFNLENBQUMsU0FBNkIsRUFBRSxTQUFrQixFQUFFLE1BQVk7UUFDM0UsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqRCxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FB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LEdBQUcsSUFBSSxPQUFPLENBQVc7WUFDNUMsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDO1lBQzdCLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDO1NBQ2hDLENBQUMsQ0FBQztRQUVILE9BQU8sSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUM3RCxDQUFDO0NBQ0YsQ0FBQTs7WUFuRitCLE9BQU87WUFDTixRQUFRO1lBQ0Usa0JBQWtCOztBQUpoRCxtQkFBbUI7SUFEL0IsVUFBVSxFQUFFO3FDQUdtQixPQUFPO1FBQ04sUUFBUTtRQUNFLGtCQUFrQjtHQUpoRCxtQkFBbUIsQ0FxRi9CO1NBckZZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RWxlbWVudFJlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3J9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29ubmVjdGVkUG9zaXRpb24sIE92ZXJsYXksIE92ZXJsYXlDb25maWcsIE92ZXJsYXlSZWYgfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQgeyBDb21wb25lbnRQb3J0YWwsIENvbXBvbmVudFR5cGUsIFBvcnRhbEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQgeyBCcmVha3BvaW50T2JzZXJ2ZXIsIEJyZWFrcG9pbnRzIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2xheW91dCc7XG5cbmltcG9ydCB7IEZzRHJhd2VyTWVudUNvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvZHJhd2VyLW1lbnUvZHJhd2VyLW1lbnUuY29tcG9uZW50JztcbmltcG9ydCB7IERyYXdlck1lbnVSZWYgfSBmcm9tICcuLi9jbGFzc2VzL2RyYXdlci1tZW51LXJlZic7XG5pbXBvcnQgeyBEcmF3ZXJEYXRhIH0gZnJvbSAnLi4vY2xhc3Nlcy9kcmF3ZXItZGF0YSc7XG5pbXBvcnQgeyBEUkFXRVJfTUVOVV9EQVRBIH0gZnJvbSAnLi4vc2VydmljZXMvZHJhd2VyLW1lbnUtZGF0YSc7XG5cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEZzRHJhd2VyTWVudVNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX292ZXJsYXk6IE92ZXJsYXksXG4gICAgICAgICAgICAgIHByaXZhdGUgX2luamVjdG9yOiBJbmplY3RvcixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfYnJlYWtwb2ludE9ic2VydmVyOiBCcmVha3BvaW50T2JzZXJ2ZXIpIHtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGUoY29tcG9uZW50OiBDb21wb25lbnRUeXBlPGFueT4sIGNvbnRhaW5lcjogRWxlbWVudCwgY29uZmlnPzogYW55KSB7XG4gICAgY29uc3Qgb3ZlcmxheVJlZiA9IHRoaXMuY3JlYXRlT3ZlcmxheShjb250YWluZXIpO1xuICAgIGNvbnN0IGRhdGFGYWN0b3J5ID0gRHJhd2VyRGF0YS5jcmVhdGVXaXRoUHJveHkoY29uZmlnLmRhdGEpO1xuICAgIGNvbnN0IG1lbnVSZWYgPSBuZXcgRHJhd2VyTWVudVJlZihvdmVybGF5UmVmLCBkYXRhRmFjdG9yeSk7XG4gICAgY29uc3QgY29udGFpbmVyUmVmID0gdGhpcy5hdHRhY2hDb250YWluZXIob3ZlcmxheVJlZiwgbWVudVJlZiwgZGF0YUZhY3RvcnkpO1xuICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHRoaXMuYXR0YWNoQ29tcG9uZW50KGNvbXBvbmVudCwgY29udGFpbmVyUmVmLCBtZW51UmVmLCBkYXRhRmFjdG9yeSk7XG4gICAgbWVudVJlZi5jb250YWluZXJSZWYgPSBjb250YWluZXJSZWY7XG4gICAgY29udGFpbmVyUmVmLnNldERyYXdlck1lbnVSZWYobWVudVJlZik7XG5cbiAgICBtZW51UmVmLmNvbXBvbmVudFJlZiA9IGNvbXBvbmVudFJlZjtcblxuICAgIHJldHVybiBtZW51UmVmO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVPdmVybGF5KGNvbnRhaW5lcjogRWxlbWVudCk6IE92ZXJsYXlSZWYge1xuICAgIGNvbnN0IG92ZXJsYXlDb25maWcgPSB0aGlzLmdldE92ZXJsYXlDb25maWcoY29udGFpbmVyKTtcbiAgICByZXR1cm4gdGhpcy5fb3ZlcmxheS5jcmVhdGUob3ZlcmxheUNvbmZpZyk7XG4gIH1cblxuICBwcml2YXRlIGdldE92ZXJsYXlDb25maWcoY29udGFpbmVyOiBFbGVtZW50KTogT3ZlcmxheUNvbmZpZyB7XG4gICAgY29uc3QgZWxlbWVudCA9IG5ldyBFbGVtZW50UmVmKGNvbnRhaW5lcik7IC8vIHBvc2l0aW9uU3RyYXRlZ3kgbmVlZHMgRWxlbWVudFJlZjtcblxuICAgIGxldCBzdHJhdGVneSA9IG51bGw7XG4gICAgaWYgKHRoaXMuX2JyZWFrcG9pbnRPYnNlcnZlci5pc01hdGNoZWQoQnJlYWtwb2ludHMuWFNtYWxsKSkge1xuICAgICAgc3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgIC5nbG9iYWwoKVxuICAgICAgICAuY2VudGVySG9yaXpvbnRhbGx5KClcbiAgICAgICAgLmNlbnRlclZlcnRpY2FsbHkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcG9zaXRpb25zOiBDb25uZWN0ZWRQb3NpdGlvbltdID0gW1xuICAgICAgICB7IG9yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICdib3R0b20nLCBvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICd0b3AnIH1cbiAgICAgIF07XG4gICAgICBzdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgLmZsZXhpYmxlQ29ubmVjdGVkVG8oZWxlbWVudClcbiAgICAgICAgLndpdGhQb3NpdGlvbnMocG9zaXRpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IE92ZXJsYXlDb25maWcoe1xuICAgICAgcG9zaXRpb25TdHJhdGVneTogc3RyYXRlZ3ksXG4gICAgICBzY3JvbGxTdHJhdGVneTogIHRoaXMuX292ZXJsYXkuc2Nyb2xsU3RyYXRlZ2llcy5yZXBvc2l0aW9uKCksXG4gICAgICBoYXNCYWNrZHJvcDogdHJ1ZSxcbiAgICAgIGJhY2tkcm9wQ2xhc3M6ICdjZGstb3ZlcmxheS10cmFuc3BhcmVudC1iYWNrZHJvcCdcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoQ29udGFpbmVyPFQsIFI+KG92ZXJsYXlSZWY6IE92ZXJsYXlSZWYsIG1lbnVSZWY6IERyYXdlck1lbnVSZWY8VCwgUj4sIGRhdGFGYWN0b3J5OiBEcmF3ZXJEYXRhKSB7XG4gICAgY29uc3QgaW5qZWN0b3IgPSB0aGlzLmNyZWF0ZUluamVjdG9yKG1lbnVSZWYsIGRhdGFGYWN0b3J5KTtcbiAgICBjb25zdCBjb250YWluZXJQb3J0YWwgPSBuZXcgQ29tcG9uZW50UG9ydGFsKEZzRHJhd2VyTWVudUNvbXBvbmVudCwgdW5kZWZpbmVkLCBpbmplY3Rvcik7XG4gICAgY29uc3QgY29udGFpbmVyUmVmID0gb3ZlcmxheVJlZi5hdHRhY2g8RnNEcmF3ZXJNZW51Q29tcG9uZW50Pihjb250YWluZXJQb3J0YWwpO1xuXG4gICAgcmV0dXJuIGNvbnRhaW5lclJlZi5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoQ29tcG9uZW50PFQsIFI+KFxuICAgIGNvbXBvbmVudFJlZjogQ29tcG9uZW50VHlwZTxUPixcbiAgICBleHRlcm5hbENvbnRhaW5lcjogRnNEcmF3ZXJNZW51Q29tcG9uZW50LFxuICAgIGV4dGVybmFsUmVmOiBEcmF3ZXJNZW51UmVmPFQsIFI+LFxuICAgIGNvbmZpZzogYW55LFxuICApIHtcblxuICAgIGNvbnN0IGluamVjdG9yID0gdGhpcy5jcmVhdGVJbmplY3RvcihleHRlcm5hbFJlZiwgY29uZmlnKTtcblxuICAgIHJldHVybiBleHRlcm5hbENvbnRhaW5lci5hdHRhY2hDb21wb25lbnRQb3J0YWw8VD4oXG4gICAgICBuZXcgQ29tcG9uZW50UG9ydGFsPFQ+KGNvbXBvbmVudFJlZiwgdW5kZWZpbmVkLCBpbmplY3RvcilcbiAgICApO1xuICB9XG5cblxuICBwcml2YXRlIGNyZWF0ZUluamVjdG9yKGNvbXBvbmVudFJlZiwgZGF0YUZhY3Rvcnk6IERyYXdlckRhdGEpIHtcbiAgICBjb25zdCBpbmplY3Rpb25Ub2tlbnMgPSBuZXcgV2Vha01hcDxhbnksIGFueT4oW1xuICAgICAgW0RyYXdlck1lbnVSZWYsIGNvbXBvbmVudFJlZl0sXG4gICAgICBbRFJBV0VSX01FTlVfREFUQSwgZGF0YUZhY3RvcnldXG4gICAgXSk7XG5cbiAgICByZXR1cm4gbmV3IFBvcnRhbEluamVjdG9yKHRoaXMuX2luamVjdG9yLCBpbmplY3Rpb25Ub2tlbnMpO1xuICB9XG59XG4iXX0=