import { __decorate, __metadata } from "tslib";
import { Directive, ElementRef, Input, NgZone, OnDestroy, OnInit, Renderer2, } from '@angular/core';
import { Subject } from 'rxjs';
import { DrawerSizeController } from '../classes/drawer-size-controller';
var FsDrawerResizerDirective = /** @class */ (function () {
    function FsDrawerResizerDirective(_el, _renderer, _ngZone) {
        this._el = _el;
        this._renderer = _renderer;
        this._ngZone = _ngZone;
        this.fsDrawerResizer = this._el.nativeElement;
        this.direction = 'left';
        this.resizable = true;
        this._dragStartHandler = this._dragStart.bind(this);
        this._dragHandler = this._drag.bind(this);
        this._dragEndHandler = this._dragEnd.bind(this);
        this._x = 0;
        this._width = 0;
        this._actionsWidth = 0;
        this._destroy$ = new Subject();
    }
    Object.defineProperty(FsDrawerResizerDirective.prototype, "width", {
        get: function () {
            return this._width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FsDrawerResizerDirective.prototype, "minWidth", {
        get: function () {
            var minWidth = this.sizeController.getMinWidth(this.type);
            if (minWidth && minWidth >= 0) {
                if (minWidth > this.sizeController.screenWidth) {
                    return this.sizeController.screenWidth;
                }
                else {
                    return minWidth;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FsDrawerResizerDirective.prototype, "maxWidth", {
        get: function () {
            var maxWidth = this.sizeController.getMaxWidth(this.type);
            var parentContainerWidth = null;
            if (this.parentContainer) {
                parentContainerWidth = this._getElementWidth(this.parentContainer.nativeElement);
            }
            if (parentContainerWidth !== null) {
                return !maxWidth || maxWidth >= parentContainerWidth
                    ? parentContainerWidth - this._actionsWidth * 2
                    : maxWidth;
            }
            else {
                return !maxWidth || maxWidth >= this.sizeController.screenWidth
                    ? this.sizeController.screenWidth
                    : maxWidth;
            }
        },
        enumerable: true,
        configurable: true
    });
    FsDrawerResizerDirective.prototype.ngOnInit = function () {
        var _this = this;
        this.sizeController.registerElRef(this);
        if (this.resizable) {
            this._ngZone.runOutsideAngular(function () {
                _this._el.nativeElement.addEventListener('mousedown', _this._dragStartHandler, false);
                _this._el.nativeElement.addEventListener('touchstart', _this._dragStartHandler, false);
            });
            if (this.actionsContainer) {
                this._actionsWidth = this._getElementWidth(this.actionsContainer.nativeElement);
            }
            this.setMinMaxStyles();
            var minWidth = this.sizeController.getMinWidth(this.type);
            var width = this.sizeController.getInitialWidth(this.type)
                || this._getElementWidth(this.fsDrawerResizer);
            if (width < minWidth) {
                width = minWidth;
            }
            this.updateWidth(width);
        }
    };
    FsDrawerResizerDirective.prototype.updateWidth = function (width) {
        var _this = this;
        this._width = width;
        requestAnimationFrame(function () {
            _this._renderer.setStyle(_this.fsDrawerResizer, 'width', width + "px");
        });
    };
    FsDrawerResizerDirective.prototype.ngOnDestroy = function () {
        this._el.nativeElement.removeEventListener('mousedown', this._dragStartHandler, false);
        this._el.nativeElement.removeEventListener('touchstart', this._dragStartHandler, false);
        this._destroy$.next();
        this._destroy$.complete();
    };
    /**
     * Set inline styles min/max width
     */
    FsDrawerResizerDirective.prototype.setMinMaxStyles = function () {
        var _this = this;
        requestAnimationFrame(function () {
            _this._renderer.setStyle(_this.fsDrawerResizer, 'min-width', _this.minWidth + "px");
            _this._renderer.setStyle(_this.fsDrawerResizer, 'max-width', _this.maxWidth + "px");
        });
    };
    /**
     * Subscribe to move events and init base dimensions/restrictions
     * @param event { MouseEvent }
     */
    FsDrawerResizerDirective.prototype._dragStart = function (event) {
        this._x = this._getClientX(event);
        this._width = this._getElementWidth(this.fsDrawerResizer);
        this.setMinMaxStyles();
        document.addEventListener('touchmove', this._dragHandler, false);
        document.addEventListener('touchend', this._dragEndHandler, false);
        document.addEventListener('mousemove', this._dragHandler, false);
        document.addEventListener('mouseup', this._dragEndHandler, false);
    };
    /**
     * Update coordinates during drag
     * @param event
     */
    FsDrawerResizerDirective.prototype._drag = function (event) {
        var clientX = this._getClientX(event);
        var predictedWidth = this._calcWidth(this.direction, clientX);
        this._updatePosition(clientX, predictedWidth);
        this._emitResizeEvent();
    };
    /**
     * Remove listeners when drag finished
     * @param event
     */
    FsDrawerResizerDirective.prototype._dragEnd = function (event) {
        document.removeEventListener('mousemove', this._dragHandler, false);
        document.removeEventListener('mouseup', this._dragEndHandler, false);
        document.removeEventListener('touchmove', this._dragHandler, false);
        document.removeEventListener('touchend', this._dragEndHandler, false);
    };
    /**
     *
     * @param event
     */
    FsDrawerResizerDirective.prototype._getClientX = function (event) {
        return event.touches ? event.touches[0].clientX : event.clientX;
    };
    /**
     * Will return width of element
     * @param el
     */
    FsDrawerResizerDirective.prototype._getElementWidth = function (el) {
        return el.getBoundingClientRect().width;
    };
    /**
     * Update width and position of target element
     * @param clientX
     * @param width
     */
    FsDrawerResizerDirective.prototype._updatePosition = function (clientX, width) {
        this._x = clientX;
        this.updateWidth(width < 0 ? 0 : width);
    };
    /**
     * Calc new width based on offset from previous position
     * @param direction
     * @param clientX
     */
    FsDrawerResizerDirective.prototype._calcWidth = function (direction, clientX) {
        var directionSign = direction === 'left' ? -1 : 1;
        return this._width + (this._x - clientX) * directionSign;
    };
    /**
     * Resize event for Window
     */
    FsDrawerResizerDirective.prototype._emitResizeEvent = function () {
        var resizeEvent = window.document.createEvent('UIEvents');
        resizeEvent.initEvent('resize', true, false);
        window.dispatchEvent(resizeEvent);
    };
    FsDrawerResizerDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NgZone }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], FsDrawerResizerDirective.prototype, "fsDrawerResizer", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], FsDrawerResizerDirective.prototype, "type", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], FsDrawerResizerDirective.prototype, "direction", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], FsDrawerResizerDirective.prototype, "resizable", void 0);
    __decorate([
        Input(),
        __metadata("design:type", ElementRef)
    ], FsDrawerResizerDirective.prototype, "parentContainer", void 0);
    __decorate([
        Input(),
        __metadata("design:type", ElementRef)
    ], FsDrawerResizerDirective.prototype, "actionsContainer", void 0);
    __decorate([
        Input(),
        __metadata("design:type", DrawerSizeController)
    ], FsDrawerResizerDirective.prototype, "sizeController", void 0);
    FsDrawerResizerDirective = __decorate([
        Directive({
            selector: '[fsDrawerResizer]',
            host: {
                '[style.cursor]': '"col-resize"',
            }
        }),
        __metadata("design:paramtypes", [ElementRef,
            Renderer2,
            NgZone])
    ], FsDrawerResizerDirective);
    return FsDrawerResizerDirective;
}());
export { FsDrawerResizerDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLXJlc2l6ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZpcmVzdGl0Y2gvZHJhd2VyLyIsInNvdXJjZXMiOlsiYXBwL2RpcmVjdGl2ZXMvZHJhd2VyLXJlc2l6ZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxNQUFNLEVBQ04sU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFTekU7SUFvQkUsa0NBQ1UsR0FBZSxFQUNmLFNBQW9CLEVBQ3BCLE9BQWU7UUFGZixRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ2YsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBckJULG9CQUFlLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7UUFFekMsY0FBUyxHQUFHLE1BQU0sQ0FBQztRQUNuQixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBS3pCLHNCQUFpQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLGlCQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsb0JBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUzQyxPQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ1AsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLGtCQUFhLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLGNBQVMsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBTS9CLENBQUM7SUFFSixzQkFBVywy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QztRQUU3QyxNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7O2dCQXJMYyxVQUFVO2dCQUNKLFNBQVM7Z0JBQ1gsTUFBTTs7SUFyQmhCO1FBQVIsS0FBSyxFQUFFOztxRUFBaUQ7SUFDaEQ7UUFBUixLQUFLLEVBQUU7OzBEQUE4QjtJQUM3QjtRQUFSLEtBQUssRUFBRTs7K0RBQTJCO0lBQzFCO1FBQVIsS0FBSyxFQUFFOzsrREFBeUI7SUFDeEI7UUFBUixLQUFLLEVBQUU7a0NBQXlCLFVBQVU7cUVBQUM7SUFDbkM7UUFBUixLQUFLLEVBQUU7a0NBQTBCLFVBQVU7c0VBQUM7SUFDcEM7UUFBUixLQUFLLEVBQUU7a0NBQXdCLG9CQUFvQjtvRUFBQztJQVIxQyx3QkFBd0I7UUFOcEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLG1CQUFtQjtZQUM3QixJQUFJLEVBQUU7Z0JBQ0osZ0JBQWdCLEVBQUUsY0FBYzthQUNqQztTQUNGLENBQUM7eUNBc0JlLFVBQVU7WUFDSixTQUFTO1lBQ1gsTUFBTTtPQXZCZCx3QkFBd0IsQ0EyTXBDO0lBQUQsK0JBQUM7Q0FBQSxBQTNNRCxJQTJNQztTQTNNWSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBEcmF3ZXJTaXplQ29udHJvbGxlciB9IGZyb20gJy4uL2NsYXNzZXMvZHJhd2VyLXNpemUtY29udHJvbGxlcic7XG5cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2ZzRHJhd2VyUmVzaXplcl0nLFxuICBob3N0OiB7XG4gICAgJ1tzdHlsZS5jdXJzb3JdJzogJ1wiY29sLXJlc2l6ZVwiJyxcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBGc0RyYXdlclJlc2l6ZXJEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgQElucHV0KCkgcHVibGljIGZzRHJhd2VyUmVzaXplciA9IHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQ7XG4gIEBJbnB1dCgpIHB1YmxpYyB0eXBlOiAnbWFpbicgfCAnc2lkZSc7XG4gIEBJbnB1dCgpIHB1YmxpYyBkaXJlY3Rpb24gPSAnbGVmdCc7XG4gIEBJbnB1dCgpIHB1YmxpYyByZXNpemFibGUgPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgcGFyZW50Q29udGFpbmVyOiBFbGVtZW50UmVmO1xuICBASW5wdXQoKSBwdWJsaWMgYWN0aW9uc0NvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQElucHV0KCkgcHVibGljIHNpemVDb250cm9sbGVyOiBEcmF3ZXJTaXplQ29udHJvbGxlcjtcblxuICBwcml2YXRlIF9kcmFnU3RhcnRIYW5kbGVyID0gdGhpcy5fZHJhZ1N0YXJ0LmJpbmQodGhpcyk7XG4gIHByaXZhdGUgX2RyYWdIYW5kbGVyID0gdGhpcy5fZHJhZy5iaW5kKHRoaXMpO1xuICBwcml2YXRlIF9kcmFnRW5kSGFuZGxlciA9IHRoaXMuX2RyYWdFbmQuYmluZCh0aGlzKTtcblxuICBwcml2YXRlIF94ID0gMDtcbiAgcHJpdmF0ZSBfd2lkdGggPSAwO1xuICBwcml2YXRlIF9hY3Rpb25zV2lkdGggPSAwO1xuXG4gIHByaXZhdGUgX2Rlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9lbDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lLFxuICApIHt9XG5cbiAgcHVibGljIGdldCB3aWR0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl93aWR0aDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG1pbldpZHRoKCk6IG51bWJlciB7XG4gICAgY29uc3QgbWluV2lkdGggPSB0aGlzLnNpemVDb250cm9sbGVyLmdldE1pbldpZHRoKHRoaXMudHlwZSk7XG5cbiAgICBpZiAobWluV2lkdGggJiYgbWluV2lkdGggPj0gMCkge1xuICAgICAgaWYgKG1pbldpZHRoID4gdGhpcy5zaXplQ29udHJvbGxlci5zY3JlZW5XaWR0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zaXplQ29udHJvbGxlci5zY3JlZW5XaWR0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBtaW5XaWR0aDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldCBtYXhXaWR0aCgpOiBudW1iZXIge1xuICAgIGNvbnN0IG1heFdpZHRoID0gdGhpcy5zaXplQ29udHJvbGxlci5nZXRNYXhXaWR0aCh0aGlzLnR5cGUpO1xuICAgIGxldCBwYXJlbnRDb250YWluZXJXaWR0aCA9IG51bGw7XG5cbiAgICBpZiAodGhpcy5wYXJlbnRDb250YWluZXIpIHtcbiAgICAgIHBhcmVudENvbnRhaW5lcldpZHRoID0gdGhpcy5fZ2V0RWxlbWVudFdpZHRoKHRoaXMucGFyZW50Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIGlmIChwYXJlbnRDb250YWluZXJXaWR0aCAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuICFtYXhXaWR0aCB8fCBtYXhXaWR0aCA+PSBwYXJlbnRDb250YWluZXJXaWR0aFxuICAgICAgICA/IHBhcmVudENvbnRhaW5lcldpZHRoIC0gdGhpcy5fYWN0aW9uc1dpZHRoICogMlxuICAgICAgICA6IG1heFdpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gIW1heFdpZHRoIHx8IG1heFdpZHRoID49IHRoaXMuc2l6ZUNvbnRyb2xsZXIuc2NyZWVuV2lkdGhcbiAgICAgICAgPyB0aGlzLnNpemVDb250cm9sbGVyLnNjcmVlbldpZHRoXG4gICAgICAgIDogbWF4V2lkdGg7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuXG4gICAgdGhpcy5zaXplQ29udHJvbGxlci5yZWdpc3RlckVsUmVmKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMucmVzaXphYmxlKSB7XG4gICAgICB0aGlzLl9uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2RyYWdTdGFydEhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5fZHJhZ1N0YXJ0SGFuZGxlciwgZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICh0aGlzLmFjdGlvbnNDb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5fYWN0aW9uc1dpZHRoID0gdGhpcy5fZ2V0RWxlbWVudFdpZHRoKHRoaXMuYWN0aW9uc0NvbnRhaW5lci5uYXRpdmVFbGVtZW50KVxuICAgICAgfVxuXG4gICAgICB0aGlzLnNldE1pbk1heFN0eWxlcygpO1xuXG4gICAgICBjb25zdCBtaW5XaWR0aCA9IHRoaXMuc2l6ZUNvbnRyb2xsZXIuZ2V0TWluV2lkdGgodGhpcy50eXBlKTtcbiAgICAgIGxldCB3aWR0aCA9IHRoaXMuc2l6ZUNvbnRyb2xsZXIuZ2V0SW5pdGlhbFdpZHRoKHRoaXMudHlwZSlcbiAgICAgICAgfHwgdGhpcy5fZ2V0RWxlbWVudFdpZHRoKHRoaXMuZnNEcmF3ZXJSZXNpemVyKTtcblxuICAgICAgaWYgKHdpZHRoIDwgbWluV2lkdGgpIHtcbiAgICAgICAgd2lkdGggPSBtaW5XaWR0aDtcbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVXaWR0aCh3aWR0aCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVwZGF0ZVdpZHRoKHdpZHRoKSB7XG4gICAgdGhpcy5fd2lkdGggPSB3aWR0aDtcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmZzRHJhd2VyUmVzaXplciwgJ3dpZHRoJywgYCR7d2lkdGh9cHhgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2RyYWdTdGFydEhhbmRsZXIsIGZhbHNlKTtcbiAgICB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLl9kcmFnU3RhcnRIYW5kbGVyLCBmYWxzZSk7XG5cbiAgICB0aGlzLl9kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5fZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgaW5saW5lIHN0eWxlcyBtaW4vbWF4IHdpZHRoXG4gICAqL1xuICBwdWJsaWMgc2V0TWluTWF4U3R5bGVzKCkge1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmZzRHJhd2VyUmVzaXplciwgJ21pbi13aWR0aCcsIGAke3RoaXMubWluV2lkdGh9cHhgKTtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuZnNEcmF3ZXJSZXNpemVyLCAnbWF4LXdpZHRoJywgYCR7dGhpcy5tYXhXaWR0aH1weGApXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3Vic2NyaWJlIHRvIG1vdmUgZXZlbnRzIGFuZCBpbml0IGJhc2UgZGltZW5zaW9ucy9yZXN0cmljdGlvbnNcbiAgICogQHBhcmFtIGV2ZW50IHsgTW91c2VFdmVudCB9XG4gICAqL1xuICBwcml2YXRlIF9kcmFnU3RhcnQoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcblxuICAgIHRoaXMuX3ggPSB0aGlzLl9nZXRDbGllbnRYKGV2ZW50KTtcbiAgICB0aGlzLl93aWR0aCA9IHRoaXMuX2dldEVsZW1lbnRXaWR0aCh0aGlzLmZzRHJhd2VyUmVzaXplcik7XG5cbiAgICB0aGlzLnNldE1pbk1heFN0eWxlcygpO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5fZHJhZ0hhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMuX2RyYWdFbmRIYW5kbGVyLCBmYWxzZSk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9kcmFnSGFuZGxlciwgZmFsc2UpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9kcmFnRW5kSGFuZGxlciwgZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBjb29yZGluYXRlcyBkdXJpbmcgZHJhZ1xuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHByaXZhdGUgX2RyYWcoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBjbGllbnRYID0gdGhpcy5fZ2V0Q2xpZW50WChldmVudCk7XG5cbiAgICBjb25zdCBwcmVkaWN0ZWRXaWR0aCA9IHRoaXMuX2NhbGNXaWR0aCh0aGlzLmRpcmVjdGlvbiwgY2xpZW50WCk7XG5cbiAgICB0aGlzLl91cGRhdGVQb3NpdGlvbihjbGllbnRYLCBwcmVkaWN0ZWRXaWR0aCk7XG4gICAgdGhpcy5fZW1pdFJlc2l6ZUV2ZW50KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGxpc3RlbmVycyB3aGVuIGRyYWcgZmluaXNoZWRcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqL1xuICBwcml2YXRlIF9kcmFnRW5kKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fZHJhZ0hhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fZHJhZ0VuZEhhbmRsZXIsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLl9kcmFnSGFuZGxlciwgZmFsc2UpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fZHJhZ0VuZEhhbmRsZXIsIGZhbHNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHByaXZhdGUgX2dldENsaWVudFgoZXZlbnQpIHtcbiAgICByZXR1cm4gZXZlbnQudG91Y2hlcyA/IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCA6IGV2ZW50LmNsaWVudFg7XG4gIH1cblxuICAvKipcbiAgICogV2lsbCByZXR1cm4gd2lkdGggb2YgZWxlbWVudFxuICAgKiBAcGFyYW0gZWxcbiAgICovXG4gIHByaXZhdGUgX2dldEVsZW1lbnRXaWR0aChlbCkge1xuICAgIHJldHVybiBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgd2lkdGggYW5kIHBvc2l0aW9uIG9mIHRhcmdldCBlbGVtZW50XG4gICAqIEBwYXJhbSBjbGllbnRYXG4gICAqIEBwYXJhbSB3aWR0aFxuICAgKi9cbiAgcHJpdmF0ZSBfdXBkYXRlUG9zaXRpb24oY2xpZW50WDogbnVtYmVyLCB3aWR0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5feCA9IGNsaWVudFg7XG4gICAgdGhpcy51cGRhdGVXaWR0aCh3aWR0aCA8IDAgPyAwIDogd2lkdGgpXG4gIH1cblxuICAvKipcbiAgICogQ2FsYyBuZXcgd2lkdGggYmFzZWQgb24gb2Zmc2V0IGZyb20gcHJldmlvdXMgcG9zaXRpb25cbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcGFyYW0gY2xpZW50WFxuICAgKi9cbiAgcHJpdmF0ZSBfY2FsY1dpZHRoKGRpcmVjdGlvbiwgY2xpZW50WCkge1xuICAgIGNvbnN0IGRpcmVjdGlvblNpZ24gPSBkaXJlY3Rpb24gPT09ICdsZWZ0JyA/IC0xIDogMTtcblxuICAgIHJldHVybiB0aGlzLl93aWR0aCArICh0aGlzLl94IC0gY2xpZW50WCkgKiBkaXJlY3Rpb25TaWduO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZSBldmVudCBmb3IgV2luZG93XG4gICAqL1xuICBwcml2YXRlIF9lbWl0UmVzaXplRXZlbnQoKSB7XG4gICAgY29uc3QgcmVzaXplRXZlbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ1VJRXZlbnRzJyk7XG4gICAgcmVzaXplRXZlbnQuaW5pdEV2ZW50KCdyZXNpemUnLCB0cnVlLCBmYWxzZSk7XG5cbiAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChyZXNpemVFdmVudCk7XG4gIH1cbn1cbiJdfQ==