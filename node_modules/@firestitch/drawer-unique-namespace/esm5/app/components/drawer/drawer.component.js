import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ComponentRef, ElementRef, EmbeddedViewRef, OnDestroy, OnInit, ViewChild, ViewEncapsulation, } from '@angular/core';
import { BasePortalOutlet, CdkPortalOutlet, } from '@angular/cdk/portal';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { DrawerRef } from '../../classes/drawer-ref';
import { FsDrawerMenuService } from '../../services/drawer-menu.service';
import { DrawerSizeController } from '../../classes/drawer-size-controller';
var FsDrawerComponent = /** @class */ (function (_super) {
    __extends(FsDrawerComponent, _super);
    function FsDrawerComponent(_el, _drawerMenu, _drawerRef, _cdRef, _resizeController) {
        var _this = _super.call(this) || this;
        _this._el = _el;
        _this._drawerMenu = _drawerMenu;
        _this._drawerRef = _drawerRef;
        _this._cdRef = _cdRef;
        _this._resizeController = _resizeController;
        _this.isOpen = false;
        _this.isOpenSide = false;
        _this.initialized = false;
        _this._sideOpen = false;
        _this._destroy$ = new Subject();
        _this._drawerRef.resizeController = _this._resizeController;
        return _this;
    }
    Object.defineProperty(FsDrawerComponent.prototype, "sideOpen", {
        get: function () {
            return this._sideOpen;
        },
        set: function (value) {
            this._sideOpen = value;
            this._el.nativeElement.classList
                .toggle('side-open', this.sideOpen);
        },
        enumerable: true,
        configurable: true
    });
    FsDrawerComponent.prototype.ngOnInit = function () {
        this._listenDataChanges();
    };
    FsDrawerComponent.prototype.ngOnDestroy = function () {
        this._destroy$.next();
        this._destroy$.complete();
    };
    FsDrawerComponent.prototype.open = function () {
        this.isOpen = true;
    };
    FsDrawerComponent.prototype.close = function () {
        this.isOpen = false;
    };
    FsDrawerComponent.prototype.openSide = function () {
        this.isOpenSide = true;
    };
    FsDrawerComponent.prototype.closeSide = function () {
        this.isOpenSide = false;
    };
    FsDrawerComponent.prototype.setDrawerRef = function (value) {
        var _this = this;
        this.drawerRef = value;
        this.config = this.drawerRef.drawerConfig;
        // Need to be like a parent for children resize
        this.drawerRef.drawerContentContainer = this._drawerContentContainer;
        this.drawerRef.drawerActionsContainer = this._drawerActionsContainer;
        this.drawerRef.sideToggle$
            .pipe(takeUntil(this._destroy$))
            .subscribe(function (opened) {
            _this.sideOpen = opened;
        });
        this.initialized = true;
    };
    /**
     * Attach a ComponentPortal as content to this dialog container.
     * @param portal Portal to be attached as the dialog content.
     */
    FsDrawerComponent.prototype.attachComponentPortal = function (portal) {
        if (this._portalOutlet.hasAttached()) {
            throw Error('Drawer component already attached');
        }
        return this._portalOutlet.attachComponentPortal(portal);
    };
    /**
     * Attach a TemplatePortal as content to this dialog container.
     * @param portal Portal to be attached as the dialog content.
     */
    FsDrawerComponent.prototype.attachTemplatePortal = function (portal) {
        if (this._portalOutlet.hasAttached()) {
            throw Error('Drawer template already attached');
        }
        return this._portalOutlet.attachTemplatePortal(portal);
    };
    FsDrawerComponent.prototype._listenDataChanges = function () {
        var _this = this;
        this._drawerRef.dataChanged$
            .pipe(takeUntil(this._destroy$))
            .subscribe(function () {
            _this._cdRef.detectChanges();
        });
    };
    FsDrawerComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: FsDrawerMenuService },
        { type: DrawerRef },
        { type: ChangeDetectorRef },
        { type: DrawerSizeController }
    ]; };
    __decorate([
        ViewChild(CdkPortalOutlet, { static: true }),
        __metadata("design:type", CdkPortalOutlet)
    ], FsDrawerComponent.prototype, "_portalOutlet", void 0);
    __decorate([
        ViewChild('drawerContentContainer', { static: true }),
        __metadata("design:type", ElementRef)
    ], FsDrawerComponent.prototype, "_drawerContentContainer", void 0);
    __decorate([
        ViewChild('drawerActionsContainer', { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], FsDrawerComponent.prototype, "_drawerActionsContainer", void 0);
    FsDrawerComponent = __decorate([
        Component({
            selector: 'fs-drawer',
            template: "<div class=\"mat-elevation-z2 drawer\" #drawer\n     hidden\n     [ngClass]=\"config.position\"\n     [hidden]=\"!initialized\">\n  <ng-container>\n    <fs-drawer-actions class=\"drawer-actions\"\n                       #drawerActionsContainer\n                       type=\"main\"\n                       [fsDrawerResizer]=\"drawer\"\n                       [resizable]=\"drawerRef.drawerConfig.resizable\"\n                       [sizeController]=\"drawerRef.resizeController\"\n                       [direction]=\"config.position\"\n                       [actions]=\"config.actions\"\n                       [activeAction]=\"drawerRef.activeAction$ | async\">\n    </fs-drawer-actions>\n    <div class=\"drawer-container\" #drawerContentContainer>\n      <ng-template cdkPortalOutlet></ng-template>\n    </div>\n  </ng-container>\n</div>\n",
            providers: [
                FsDrawerMenuService,
                DrawerSizeController,
            ],
            host: {
                'class': 'fs-drawer-container',
            },
            encapsulation: ViewEncapsulation.None,
            changeDetection: ChangeDetectionStrategy.OnPush
        }),
        __metadata("design:paramtypes", [ElementRef,
            FsDrawerMenuService,
            DrawerRef,
            ChangeDetectorRef,
            DrawerSizeController])
    ], FsDrawerComponent);
    return FsDrawerComponent;
}(BasePortalOutlet));
export { FsDrawerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXJlc3RpdGNoL2RyYXdlci8iLCJzb3VyY2VzIjpbImFwcC9jb21wb25lbnRzL2RyYXdlci9kcmF3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQzFDLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLGVBQWUsRUFDZixTQUFTLEVBQ1QsTUFBTSxFQUNOLFNBQVMsRUFDVCxpQkFBaUIsR0FDbEIsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixlQUFlLEdBR2hCLE1BQU0scUJBQXFCLENBQUM7QUFFN0IsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXJELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBZ0I1RTtJQUF1QyxxQ0FBZ0I7SUFzQnJELDJCQUNVLEdBQTRCLEVBQzVCLFdBQWdDLEVBQ2hDLFVBQTBCLEVBQzFCLE1BQXlCLEVBQ3pCLGlCQUF1QztRQUxqRCxZQU9FLGlCQUFPLFNBR1I7UUFUUyxTQUFHLEdBQUgsR0FBRyxDQUF5QjtRQUM1QixpQkFBVyxHQUFYLFdBQVcsQ0FBcUI7UUFDaEMsZ0JBQVUsR0FBVixVQUFVLENBQWdCO1FBQzFCLFlBQU0sR0FBTixNQUFNLENBQW1CO1FBQ3pCLHVCQUFpQixHQUFqQixpQkFBaUIsQ0FBc0I7UUF4QjFDLFlBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixnQkFBVSxHQUFHLEtBQUssQ0FBQztRQUluQixpQkFBVyxHQUFHLEtBQUss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QyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDOztnQkFuR2MsVUFBVTtnQkFDRixtQkFBbUI7Z0JBQ3BCLFNBQVM7Z0JBQ2IsaUJBQWlCO2dCQUNOLG9CQUFvQjs7SUFoQmpEO1FBREMsU0FBUyxDQUFDLGVBQWUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztrQ0FDdEIsZUFBZTs0REFBQztJQUd2QztRQURDLFNBQVMsQ0FBQyx3QkFBd0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztrQ0FDckIsVUFBVTtzRUFBQztJQUc1QztRQURDLFNBQVMsQ0FBQyx3QkFBd0IsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO2tDQUN2QyxVQUFVO3NFQUFDO0lBakJqQyxpQkFBaUI7UUFiN0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFdBQVc7WUFDckIsdzFCQUFzQztZQUN0QyxTQUFTLEVBQUU7Z0JBQ1QsbUJBQW1CO2dCQUNuQixvQkFBb0I7YUFDckI7WUFDRCxJQUFJLEVBQUU7Z0JBQ0osT0FBTyxFQUFFLHFCQUFxQjthQUMvQjtZQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO1lBQ3JDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO1NBQ2hELENBQUM7eUNBd0JlLFVBQVU7WUFDRixtQkFBbUI7WUFDcEIsU0FBUztZQUNiLGlCQUFpQjtZQUNOLG9CQUFvQjtPQTNCdEMsaUJBQWlCLENBMkg3QjtJQUFELHdCQUFDO0NBQUEsQUEzSEQsQ0FBdUMsZ0JBQWdCLEdBMkh0RDtTQTNIWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29tcG9uZW50UmVmLFxuICBFbGVtZW50UmVmLFxuICBFbWJlZGRlZFZpZXdSZWYsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgQmFzZVBvcnRhbE91dGxldCxcbiAgQ2RrUG9ydGFsT3V0bGV0LFxuICBDb21wb25lbnRQb3J0YWwsXG4gIFRlbXBsYXRlUG9ydGFsLFxufSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcblxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBEcmF3ZXJSZWYgfSBmcm9tICcuLi8uLi9jbGFzc2VzL2RyYXdlci1yZWYnO1xuaW1wb3J0IHsgRHJhd2VyQ29uZmlnIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2RyYXdlci1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgRnNEcmF3ZXJNZW51U2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RyYXdlci1tZW51LnNlcnZpY2UnO1xuaW1wb3J0IHsgRHJhd2VyU2l6ZUNvbnRyb2xsZXIgfSBmcm9tICcuLi8uLi9jbGFzc2VzL2RyYXdlci1zaXplLWNvbnRyb2xsZXInO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZzLWRyYXdlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kcmF3ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtcbiAgICBGc0RyYXdlck1lbnVTZXJ2aWNlLFxuICAgIERyYXdlclNpemVDb250cm9sbGVyLFxuICBdLFxuICBob3N0OiB7XG4gICAgJ2NsYXNzJzogJ2ZzLWRyYXdlci1jb250YWluZXInLFxuICB9LFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRnNEcmF3ZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlUG9ydGFsT3V0bGV0IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gIHB1YmxpYyBjb25maWc6IERyYXdlckNvbmZpZztcbiAgcHVibGljIGlzT3BlbiA9IGZhbHNlO1xuICBwdWJsaWMgaXNPcGVuU2lkZSA9IGZhbHNlO1xuXG4gIHB1YmxpYyBkcmF3ZXJSZWY6IERyYXdlclJlZjxhbnk+O1xuXG4gIHB1YmxpYyBpbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoQ2RrUG9ydGFsT3V0bGV0LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBwcml2YXRlIF9wb3J0YWxPdXRsZXQ6IENka1BvcnRhbE91dGxldDtcblxuICBAVmlld0NoaWxkKCdkcmF3ZXJDb250ZW50Q29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSlcbiAgcHJpdmF0ZSBfZHJhd2VyQ29udGVudENvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKCdkcmF3ZXJBY3Rpb25zQ29udGFpbmVyJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgcHJpdmF0ZSBfZHJhd2VyQWN0aW9uc0NvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIF9zaWRlT3BlbiA9IGZhbHNlO1xuICBwcml2YXRlIF9kZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfZWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgIHByaXZhdGUgX2RyYXdlck1lbnU6IEZzRHJhd2VyTWVudVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBfZHJhd2VyUmVmOiBEcmF3ZXJSZWY8YW55PixcbiAgICBwcml2YXRlIF9jZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBfcmVzaXplQ29udHJvbGxlcjogRHJhd2VyU2l6ZUNvbnRyb2xsZXIsXG4gICkge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLl9kcmF3ZXJSZWYucmVzaXplQ29udHJvbGxlciA9IHRoaXMuX3Jlc2l6ZUNvbnRyb2xsZXI7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNpZGVPcGVuKCkge1xuICAgIHJldHVybiB0aGlzLl9zaWRlT3BlbjtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgc2lkZU9wZW4odmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zaWRlT3BlbiA9IHZhbHVlO1xuXG4gICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudC5jbGFzc0xpc3RcbiAgICAgIC50b2dnbGUoJ3NpZGUtb3BlbicsIHRoaXMuc2lkZU9wZW4pO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuICAgIHRoaXMuX2xpc3RlbkRhdGFDaGFuZ2VzKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBwdWJsaWMgb3BlbigpIHtcbiAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBvcGVuU2lkZSgpIHtcbiAgICB0aGlzLmlzT3BlblNpZGUgPSB0cnVlO1xuICB9XG5cbiAgcHVibGljIGNsb3NlU2lkZSgpIHtcbiAgICB0aGlzLmlzT3BlblNpZGUgPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXREcmF3ZXJSZWYodmFsdWU6IERyYXdlclJlZjxhbnk+KSB7XG4gICAgdGhpcy5kcmF3ZXJSZWYgPSB2YWx1ZTtcblxuICAgIHRoaXMuY29uZmlnID0gdGhpcy5kcmF3ZXJSZWYuZHJhd2VyQ29uZmlnO1xuXG4gICAgLy8gTmVlZCB0byBiZSBsaWtlIGEgcGFyZW50IGZvciBjaGlsZHJlbiByZXNpemVcbiAgICB0aGlzLmRyYXdlclJlZi5kcmF3ZXJDb250ZW50Q29udGFpbmVyID0gdGhpcy5fZHJhd2VyQ29udGVudENvbnRhaW5lcjtcbiAgICB0aGlzLmRyYXdlclJlZi5kcmF3ZXJBY3Rpb25zQ29udGFpbmVyID0gdGhpcy5fZHJhd2VyQWN0aW9uc0NvbnRhaW5lcjtcblxuICAgIHRoaXMuZHJhd2VyUmVmLnNpZGVUb2dnbGUkXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKG9wZW5lZCkgPT4ge1xuICAgICAgICB0aGlzLnNpZGVPcGVuID0gb3BlbmVkO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2ggYSBDb21wb25lbnRQb3J0YWwgYXMgY29udGVudCB0byB0aGlzIGRpYWxvZyBjb250YWluZXIuXG4gICAqIEBwYXJhbSBwb3J0YWwgUG9ydGFsIHRvIGJlIGF0dGFjaGVkIGFzIHRoZSBkaWFsb2cgY29udGVudC5cbiAgICovXG4gIHB1YmxpYyBhdHRhY2hDb21wb25lbnRQb3J0YWw8VD4ocG9ydGFsOiBDb21wb25lbnRQb3J0YWw8VD4pOiBDb21wb25lbnRSZWY8VD4ge1xuICAgIGlmICh0aGlzLl9wb3J0YWxPdXRsZXQuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgdGhyb3cgRXJyb3IoJ0RyYXdlciBjb21wb25lbnQgYWxyZWFkeSBhdHRhY2hlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9wb3J0YWxPdXRsZXQuYXR0YWNoQ29tcG9uZW50UG9ydGFsKHBvcnRhbCk7XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoIGEgVGVtcGxhdGVQb3J0YWwgYXMgY29udGVudCB0byB0aGlzIGRpYWxvZyBjb250YWluZXIuXG4gICAqIEBwYXJhbSBwb3J0YWwgUG9ydGFsIHRvIGJlIGF0dGFjaGVkIGFzIHRoZSBkaWFsb2cgY29udGVudC5cbiAgICovXG4gIHB1YmxpYyBhdHRhY2hUZW1wbGF0ZVBvcnRhbDxDPihwb3J0YWw6IFRlbXBsYXRlUG9ydGFsPEM+KTogRW1iZWRkZWRWaWV3UmVmPEM+IHtcbiAgICBpZiAodGhpcy5fcG9ydGFsT3V0bGV0Lmhhc0F0dGFjaGVkKCkpIHtcbiAgICAgIHRocm93IEVycm9yKCdEcmF3ZXIgdGVtcGxhdGUgYWxyZWFkeSBhdHRhY2hlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9wb3J0YWxPdXRsZXQuYXR0YWNoVGVtcGxhdGVQb3J0YWwocG9ydGFsKTtcbiAgfVxuXG4gIHByaXZhdGUgX2xpc3RlbkRhdGFDaGFuZ2VzKCkge1xuICAgIHRoaXMuX2RyYXdlclJlZi5kYXRhQ2hhbmdlZCRcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5fY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==