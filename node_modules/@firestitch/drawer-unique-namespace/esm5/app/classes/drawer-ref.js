import { __assign, __read, __spread } from "tslib";
import { ESCAPE } from '@angular/cdk/keycodes';
import { BehaviorSubject, Observable, Subject, zip } from 'rxjs';
import { filter, take, takeUntil } from 'rxjs/operators';
import { DrawerConfig } from '../models/drawer-config.model';
var DrawerRef = /** @class */ (function () {
    function DrawerRef(_overlayRef, _dataFactory, _config) {
        this._overlayRef = _overlayRef;
        this._dataFactory = _dataFactory;
        /** Subject for notifying the user that the drawer has finished opening. */
        this._afterOpened$ = new Subject();
        /** Subject for notifying the user that the drawer has finished closing. */
        this._afterClosed$ = new Subject();
        /** Subject for notifying the user that the drawer has started closing. */
        this._closeStart$ = new Subject();
        /** Subject for notifying the user that the drawer has started opening. */
        this._openStart$ = new Subject();
        /** Subject for notifying the user that the drawer has started closing. */
        this._sideToggle = new Subject();
        /** Subject for notifying the user that the drawer has finished opening. */
        this._actionsUpdated$ = new Subject();
        /** Destroy notifier **/
        this._destroy$ = new Subject();
        this._activeAction = new BehaviorSubject(void 0);
        this._menuRefs = new Map();
        this._isOpen = false;
        this._isSideOpen = false;
        this.drawerConfig = new DrawerConfig(_config);
        this._activeAction.next(this.drawerConfig.activeAction);
    }
    Object.defineProperty(DrawerRef.prototype, "overlayRef", {
        get: function () {
            return this._overlayRef;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "drawerData", {
        /**
         * Getter for DRAWER_DATA for current drawer
         */
        get: function () {
            return __assign({}, this._dataFactory.getValue()); // Like immutable.... TODO switch to Immer
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "destroy$", {
        get: function () {
            return this._destroy$.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "containerRef", {
        /**
         * Set reference to drawer container
         * @param value
         */
        set: function (value) {
            this._drawerContainerRef = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "componentRef", {
        /**
         * Set reference to drawer component
         * @param value
         */
        set: function (value) {
            this._drawerComponentRef = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "drawerContentContainer", {
        get: function () {
            return this._drawerContentContainer;
        },
        set: function (value) {
            this._drawerContentContainer = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "drawerActionsContainer", {
        get: function () {
            return this._drawerActionsContainer;
        },
        set: function (value) {
            this._drawerActionsContainer = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "activeAction", {
        get: function () {
            return this._activeAction.getValue();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "activeAction$", {
        get: function () {
            return this._activeAction.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "isOpen", {
        /**
         * Return actual status of the drawer
         */
        get: function () {
            return this._isOpen;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "isSideOpen", {
        /**
         * Return actual status of the side of the drawer
         */
        get: function () {
            return this._isSideOpen;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "resizeController", {
        get: function () {
            return this._resizeController;
        },
        set: function (value) {
            this._resizeController = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "actionUpdated$", {
        /**
         * Gets an observable that action was updated and change detection should be started
         */
        get: function () {
            return this._actionsUpdated$.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "afterClosed$", {
        /**
         * Gets an observable that is notified when the dialog is finished closing.
         */
        get: function () {
            return this._afterClosed$.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "afterOpened$", {
        /**
         * Gets an observable that is notified when the dialog is finished opening.
         */
        get: function () {
            return this._afterOpened$.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "openStart$", {
        /**
         * Gets an observable that is notified when the dialog open starts.
         */
        get: function () {
            return this._openStart$.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "closeStart$", {
        /**
         * Gets an observable that is notified when the dialog is finished opening.
         */
        get: function () {
            return this._closeStart$.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "dataChanged$", {
        /**
         * Gets an observable that is notified when data in DRAWER_DATA was changed
         */
        get: function () {
            return this._dataFactory.dataChange$;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DrawerRef.prototype, "sideToggle$", {
        /**
         * Gets an observable that is notify that side status toggled
         */
        get: function () {
            return this._sideToggle.pipe(takeUntil(this._destroy$));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Subscribe on keydown events to react on escape
     */
    DrawerRef.prototype.events = function () {
        var _this = this;
        this._overlayRef.keydownEvents()
            .pipe(filter(function (event) { return event.keyCode === ESCAPE && !_this.drawerConfig.disableClose; }), takeUntil(this._destroy$))
            .subscribe(function () { return _this.close(); });
    };
    /**
     * Set value for DRAWER_DATA
     * @param data
     */
    DrawerRef.prototype.dataChange = function (data) {
        this._dataFactory.setValue(data);
    };
    /**
     * Open drawer and notify observable
     */
    DrawerRef.prototype.open = function () {
        var _this = this;
        new Observable(function (obs) {
            setTimeout(function () {
                if (_this._openStart$.observers.length) {
                    _this._openStart$.next(obs);
                }
                else {
                    obs.next();
                    obs.complete();
                }
            });
        }).pipe(takeUntil(this._destroy$))
            .subscribe({
            next: function () {
                if (_this.activeAction) {
                    _this.openSide();
                }
                _this._drawerContainerRef.open();
                _this._afterOpened$.next();
                _this._afterOpened$.complete();
            },
            error: function () {
                _this.destroy();
            },
        });
    };
    /**
     * Close the drawer.
     * @param result Optional result to return to the dialog opener.
     */
    DrawerRef.prototype.close = function (result) {
        var _this = this;
        new Observable(function (observer) {
            if (_this._closeStart$.observers.length) {
                zip.apply(void 0, __spread(_this._closeStart$.observers.map(function (item) {
                    return Observable.create(function (closeObserver) {
                        item.next(closeObserver);
                    });
                }))).pipe(takeUntil(_this._destroy$))
                    .subscribe(function () {
                    observer.next();
                    observer.complete();
                }, function () {
                    observer.error();
                });
            }
            else {
                observer.next();
                observer.complete();
            }
        }).pipe(takeUntil(this._destroy$))
            .subscribe({
            next: function () {
                _this._drawerContainerRef.close();
                _this._result = result;
                _this._afterClosed$.next(result);
                _this.destroy();
            }
        });
    };
    /**
     * Open the side of the drawer
     */
    DrawerRef.prototype.openSide = function () {
        this._isSideOpen = true;
        this._sideToggle.next(this._isSideOpen);
    };
    /**
     * Close the side of the drawer
     */
    DrawerRef.prototype.closeSide = function () {
        this._isSideOpen = false;
        this._sideToggle.next(this._isSideOpen);
        this.setActiveAction(null);
    };
    /**
     * Toggle the side of the drawer
     */
    DrawerRef.prototype.toggleSide = function () {
        this.isSideOpen ? this.closeSide() : this.openSide();
    };
    /**
     * Change active action
     * @param name
     */
    DrawerRef.prototype.setActiveAction = function (name) {
        this._activeAction.next(name);
        if (name) {
            this.openSide();
        }
    };
    /**
     * Store opened menu reference and subscribe for auto remove
     * @param name
     * @param ref
     */
    DrawerRef.prototype.addMenuRef = function (name, ref) {
        var _this = this;
        this._menuRefs.set(name, ref);
        ref.afterClosed()
            .pipe(take(1), takeUntil(this._destroy$))
            .subscribe(function () {
            _this._menuRefs.delete(name);
        });
    };
    /**
     * Get opened menu reference by name
     * @param name
     */
    DrawerRef.prototype.getMenuRef = function (name) {
        return this._menuRefs.get(name);
    };
    DrawerRef.prototype.getAction = function (name) {
        return this.drawerConfig.actions.find(function (action) { return action.name === name; });
    };
    /**
     * Do update for icon for target action
     * @param name
     * @param icon
     */
    DrawerRef.prototype.updateActionIcon = function (name, icon) {
        var action = this.getAction(name);
        if (action) {
            action.icon = icon;
            this._actionsUpdated$.next(name);
        }
    };
    /**
     * Do update
     * @param name
     * @param data
     */
    DrawerRef.prototype.updateAction = function (name, data) {
        var action = this.getAction(name);
        if (action) {
            var allowedFields_1 = ['icon', 'type', 'toggle', 'tooltip', 'close', 'closeSide', 'component', 'data'];
            var forUpdate = Object.keys(data).filter(function (key) { return allowedFields_1.indexOf(key) > -1; });
            forUpdate.forEach(function (key) {
                action[key] = data[key];
            });
            this._actionsUpdated$.next(name);
        }
    };
    DrawerRef.prototype.updateDrawerWidth = function (width) {
        this.resizeController.updateMainWidth(width);
    };
    DrawerRef.prototype.updateSideDrawerWidth = function (width) {
        this.resizeController.updateSideWidth(width);
    };
    DrawerRef.prototype.destroy = function () {
        this._overlayRef.detachBackdrop();
        this._overlayRef.detach();
        this._drawerComponentRef.destroy();
        this._dataFactory.destroy();
        this._destroy$.next();
        this._destroy$.complete();
    };
    return DrawerRef;
}());
export { DrawerRef };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLXJlZi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXJlc3RpdGNoL2RyYXdlci8iLCJzb3VyY2VzIjpbImFwcC9jbGFzc2VzL2RyYXdlci1yZWYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUcvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQWMsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdFLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSXpELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQU03RDtJQWtERSxtQkFDVSxXQUF1QixFQUN2QixZQUF3QixFQUNoQyxPQUFzQjtRQUZkLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQ3ZCLGlCQUFZLEdBQVosWUFBWSxDQUFZO1FBaERsQywyRUFBMkU7UUFDMUQsa0JBQWEsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBRXJELDJFQUEyRTtRQUMxRCxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFpQixDQUFDO1FBRTlELDBFQUEwRTtRQUN6RCxpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFvQixDQUFDO1FBRWhFLDBFQUEwRTtRQUN6RCxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFvQixDQUFDO1FBRS9ELDBFQUEwRTtRQUN6RCxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFFdEQsMkVBQTJFO1FBQzFELHFCQUFnQixHQUFHLElBQUksT0FBTyxFQUFVLENBQUM7UUFFMUQsd0JBQXdCO1FBQ1AsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFtQnpDLGtCQUFhLEdBQUcsSUFBSSxlQUFlLENBQVMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVwRCxjQUFTLEdBQUcsSUFBSSxHQUFHLEVBQStCLENB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QUFJLENBQUMsQ0FBQztTQUNsQztJQUNILENBQUM7SUFFTSxxQ0FBaUIsR0FBeEIsVUFBeUIsS0FBYTtRQUNwQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFTSx5Q0FBcUIsR0FBNUIsVUFBNkIsS0FBYTtRQUN4QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFTSwyQkFBTyxHQUFkO1FBQ0UsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNsQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRTVCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRUgsZ0JBQUM7QUFBRCxDQUFDLEFBellELElBeVlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50UmVmLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBFU0NBUEUgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgT3ZlcmxheVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcblxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpYmVyLCB6aXAgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgdGFrZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBEcmF3ZXJEYXRhIH0gZnJvbSAnLi9kcmF3ZXItZGF0YSc7XG5pbXBvcnQgeyBGc0RyYXdlckNvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvZHJhd2VyL2RyYXdlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgRHJhd2VyQ29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL2RyYXdlci1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgRHJhd2VyTWVudVJlZiB9IGZyb20gJy4uL2NsYXNzZXMvZHJhd2VyLW1lbnUtcmVmJztcbmltcG9ydCB7IElEcmF3ZXJDb25maWcgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2RyYXdlci1jb25maWcuaW50ZXJmYWNlJztcbmltcG9ydCB7IERyYXdlclNpemVDb250cm9sbGVyIH0gZnJvbSAnLi9kcmF3ZXItc2l6ZS1jb250cm9sbGVyJztcblxuXG5leHBvcnQgY2xhc3MgRHJhd2VyUmVmPFQsIFIgPSBhbnk+IHtcblxuICBwdWJsaWMgcmVhZG9ubHkgZHJhd2VyQ29uZmlnOiBEcmF3ZXJDb25maWc7XG5cbiAgLyoqIFN1YmplY3QgZm9yIG5vdGlmeWluZyB0aGUgdXNlciB0aGF0IHRoZSBkcmF3ZXIgaGFzIGZpbmlzaGVkIG9wZW5pbmcuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX2FmdGVyT3BlbmVkJCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgLyoqIFN1YmplY3QgZm9yIG5vdGlmeWluZyB0aGUgdXNlciB0aGF0IHRoZSBkcmF3ZXIgaGFzIGZpbmlzaGVkIGNsb3NpbmcuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX2FmdGVyQ2xvc2VkJCA9IG5ldyBTdWJqZWN0PFIgfCB1bmRlZmluZWQ+KCk7XG5cbiAgLyoqIFN1YmplY3QgZm9yIG5vdGlmeWluZyB0aGUgdXNlciB0aGF0IHRoZSBkcmF3ZXIgaGFzIHN0YXJ0ZWQgY2xvc2luZy4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfY2xvc2VTdGFydCQgPSBuZXcgU3ViamVjdDxTdWJzY3JpYmVyPHZvaWQ+PigpO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBzdGFydGVkIG9wZW5pbmcuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX29wZW5TdGFydCQgPSBuZXcgU3ViamVjdDxTdWJzY3JpYmVyPHZvaWQ+PigpO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBzdGFydGVkIGNsb3NpbmcuICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX3NpZGVUb2dnbGUgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gIC8qKiBTdWJqZWN0IGZvciBub3RpZnlpbmcgdGhlIHVzZXIgdGhhdCB0aGUgZHJhd2VyIGhhcyBmaW5pc2hlZCBvcGVuaW5nLiAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9hY3Rpb25zVXBkYXRlZCQgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG5cbiAgLyoqIERlc3Ryb3kgbm90aWZpZXIgKiovXG4gIHByaXZhdGUgcmVhZG9ubHkgX2Rlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAvKiogUmVzdWx0IHRvIGJlIHBhc3NlZCB0byBhZnRlckNsb3NlZC4gKi9cbiAgcHJpdmF0ZSBfcmVzdWx0OiBSIHwgdW5kZWZpbmVkO1xuXG4gIC8qKiBNYWluIGRyYXdlciBjb21wb25lbnQgYW5kIHRlbXBsYXRlICovXG4gIHByaXZhdGUgX2RyYXdlckNvbnRhaW5lclJlZjogRnNEcmF3ZXJDb21wb25lbnQ7XG5cbiAgLyoqIE1haW4gZHJhd2VyIGNvbXBvbmVudCBhbmQgdGVtcGxhdGUgKi9cbiAgcHJpdmF0ZSBfZHJhd2VyQ29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8VD47XG5cbiAgLyoqIERyYXdlciBDb250ZW50IFRlbXBsYXRlICovXG4gIHByaXZhdGUgX2RyYXdlckNvbnRlbnRDb250YWluZXI6IEVsZW1lbnRSZWY7XG5cbiAgLyoqIERyYXdlciBBY3Rpb25zIFRlbXBsYXRlICovXG4gIHByaXZhdGUgX2RyYXdlckFjdGlvbnNDb250YWluZXI6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBfcmVzaXplQ29udHJvbGxlcjogRHJhd2VyU2l6ZUNvbnRyb2xsZXI7XG5cbiAgcHJpdmF0ZSBfYWN0aXZlQWN0aW9uID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHZvaWQgMCk7XG5cbiAgcHJpdmF0ZSBfbWVudVJlZnMgPSBuZXcgTWFwPHN0cmluZywgRHJhd2VyTWVudVJlZjxULCBSPj4oKTtcblxuICBwcml2YXRlIF9pc09wZW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaXNTaWRlT3BlbiA9IGZhbHNlO1xuXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfb3ZlcmxheVJlZjogT3ZlcmxheVJlZixcbiAgICBwcml2YXRlIF9kYXRhRmFjdG9yeTogRHJhd2VyRGF0YSxcbiAgICBfY29uZmlnOiBJRHJhd2VyQ29uZmlnXG4gICkge1xuICAgIHRoaXMuZHJhd2VyQ29uZmlnID0gbmV3IERyYXdlckNvbmZpZyhfY29uZmlnKTtcbiAgICB0aGlzLl9hY3RpdmVBY3Rpb24ubmV4dCh0aGlzLmRyYXdlckNvbmZpZy5hY3RpdmVBY3Rpb24pO1xuICB9XG5cbiAgcHVibGljIGdldCBvdmVybGF5UmVmKCkge1xuICAgIHJldHVybiB0aGlzLl9vdmVybGF5UmVmO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHRlciBmb3IgRFJBV0VSX0RBVEEgZm9yIGN1cnJlbnQgZHJhd2VyXG4gICAqL1xuICBwdWJsaWMgZ2V0IGRyYXdlckRhdGEoKSB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5fZGF0YUZhY3RvcnkuZ2V0VmFsdWUoKSB9IC8vIExpa2UgaW1tdXRhYmxlLi4uLiBUT0RPIHN3aXRjaCB0byBJbW1lclxuICB9XG5cbiAgcHVibGljIGdldCBkZXN0cm95JCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGVzdHJveSQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHJlZmVyZW5jZSB0byBkcmF3ZXIgY29udGFpbmVyXG4gICAqIEBwYXJhbSB2YWx1ZVxuICAgKi9cbiAgcHVibGljIHNldCBjb250YWluZXJSZWYodmFsdWU6IEZzRHJhd2VyQ29tcG9uZW50KSB7XG4gICAgdGhpcy5fZHJhd2VyQ29udGFpbmVyUmVmID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHJlZmVyZW5jZSB0byBkcmF3ZXIgY29tcG9uZW50XG4gICAqIEBwYXJhbSB2YWx1ZVxuICAgKi9cbiAgcHVibGljIHNldCBjb21wb25lbnRSZWYodmFsdWU6IENvbXBvbmVudFJlZjxUPikge1xuICAgIHRoaXMuX2RyYXdlckNvbXBvbmVudFJlZiA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldCBkcmF3ZXJDb250ZW50Q29udGFpbmVyKHZhbHVlOiBFbGVtZW50UmVmKSB7XG4gICAgdGhpcy5fZHJhd2VyQ29udGVudENvbnRhaW5lciA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIHNldCBkcmF3ZXJBY3Rpb25zQ29udGFpbmVyKHZhbHVlOiBFbGVtZW50UmVmKSB7XG4gICAgdGhpcy5fZHJhd2VyQWN0aW9uc0NvbnRhaW5lciA9IHZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldCBkcmF3ZXJDb250ZW50Q29udGFpbmVyKCk6IEVsZW1lbnRSZWYge1xuICAgIHJldHVybiB0aGlzLl9kcmF3ZXJDb250ZW50Q29udGFpbmVyO1xuICB9XG5cbiAgcHVibGljIGdldCBkcmF3ZXJBY3Rpb25zQ29udGFpbmVyKCk6IEVsZW1lbnRSZWYge1xuICAgIHJldHVybiB0aGlzLl9kcmF3ZXJBY3Rpb25zQ29udGFpbmVyO1xuICB9XG5cbiAgcHVibGljIGdldCBhY3RpdmVBY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUFjdGlvbi5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgcHVibGljIGdldCBhY3RpdmVBY3Rpb24kKCkge1xuICAgIHJldHVybiB0aGlzLl9hY3RpdmVBY3Rpb24ucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWN0dWFsIHN0YXR1cyBvZiB0aGUgZHJhd2VyXG4gICAqL1xuICBwdWJsaWMgZ2V0IGlzT3BlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faXNPcGVuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhY3R1YWwgc3RhdHVzIG9mIHRoZSBzaWRlIG9mIHRoZSBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyBnZXQgaXNTaWRlT3BlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faXNTaWRlT3BlbjtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgcmVzaXplQ29udHJvbGxlcih2YWx1ZTogRHJhd2VyU2l6ZUNvbnRyb2xsZXIpIHtcbiAgICB0aGlzLl9yZXNpemVDb250cm9sbGVyID0gdmFsdWU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHJlc2l6ZUNvbnRyb2xsZXIoKTogRHJhd2VyU2l6ZUNvbnRyb2xsZXIge1xuICAgIHJldHVybiB0aGlzLl9yZXNpemVDb250cm9sbGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYW4gb2JzZXJ2YWJsZSB0aGF0IGFjdGlvbiB3YXMgdXBkYXRlZCBhbmQgY2hhbmdlIGRldGVjdGlvbiBzaG91bGQgYmUgc3RhcnRlZFxuICAgKi9cbiAgcHVibGljIGdldCBhY3Rpb25VcGRhdGVkJCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLl9hY3Rpb25zVXBkYXRlZCQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBpcyBub3RpZmllZCB3aGVuIHRoZSBkaWFsb2cgaXMgZmluaXNoZWQgY2xvc2luZy5cbiAgICovXG4gIHB1YmxpYyBnZXQgYWZ0ZXJDbG9zZWQkKCk6IE9ic2VydmFibGU8UiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLl9hZnRlckNsb3NlZCQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBpcyBub3RpZmllZCB3aGVuIHRoZSBkaWFsb2cgaXMgZmluaXNoZWQgb3BlbmluZy5cbiAgICovXG4gIHB1YmxpYyBnZXQgYWZ0ZXJPcGVuZWQkKCk6IE9ic2VydmFibGU8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLl9hZnRlck9wZW5lZCQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBpcyBub3RpZmllZCB3aGVuIHRoZSBkaWFsb2cgb3BlbiBzdGFydHMuXG4gICAqL1xuICBwdWJsaWMgZ2V0IG9wZW5TdGFydCQoKTogT2JzZXJ2YWJsZTxTdWJzY3JpYmVyPHZvaWQ+PiB7XG4gICAgcmV0dXJuIHRoaXMuX29wZW5TdGFydCQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBpcyBub3RpZmllZCB3aGVuIHRoZSBkaWFsb2cgaXMgZmluaXNoZWQgb3BlbmluZy5cbiAgICovXG4gIHB1YmxpYyBnZXQgY2xvc2VTdGFydCQoKTogT2JzZXJ2YWJsZTxTdWJzY3JpYmVyPHZvaWQ+PiB7XG4gICAgcmV0dXJuIHRoaXMuX2Nsb3NlU3RhcnQkLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbiBvYnNlcnZhYmxlIHRoYXQgaXMgbm90aWZpZWQgd2hlbiBkYXRhIGluIERSQVdFUl9EQVRBIHdhcyBjaGFuZ2VkXG4gICAqL1xuICBwdWJsaWMgZ2V0IGRhdGFDaGFuZ2VkJCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLl9kYXRhRmFjdG9yeS5kYXRhQ2hhbmdlJDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFuIG9ic2VydmFibGUgdGhhdCBpcyBub3RpZnkgdGhhdCBzaWRlIHN0YXR1cyB0b2dnbGVkXG4gICAqL1xuICBwdWJsaWMgZ2V0IHNpZGVUb2dnbGUkKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLl9zaWRlVG9nZ2xlLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSk7XG4gIH1cblxuICAvKipcbiAgICogU3Vic2NyaWJlIG9uIGtleWRvd24gZXZlbnRzIHRvIHJlYWN0IG9uIGVzY2FwZVxuICAgKi9cbiAgcHVibGljIGV2ZW50cygpIHtcbiAgICB0aGlzLl9vdmVybGF5UmVmLmtleWRvd25FdmVudHMoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcihldmVudCA9PiBldmVudC5rZXlDb2RlID09PSBFU0NBUEUgJiYgIXRoaXMuZHJhd2VyQ29uZmlnLmRpc2FibGVDbG9zZSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuY2xvc2UoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHZhbHVlIGZvciBEUkFXRVJfREFUQVxuICAgKiBAcGFyYW0gZGF0YVxuICAgKi9cbiAgcHVibGljIGRhdGFDaGFuZ2UoZGF0YSkge1xuICAgIHRoaXMuX2RhdGFGYWN0b3J5LnNldFZhbHVlKGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gZHJhd2VyIGFuZCBub3RpZnkgb2JzZXJ2YWJsZVxuICAgKi9cbiAgcHVibGljIG9wZW4oKSB7XG4gICAgbmV3IE9ic2VydmFibGU8dm9pZD4oKG9icykgPT4ge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7IC8vIEZJWE1FIENydXRjaFxuICAgICAgICBpZiAodGhpcy5fb3BlblN0YXJ0JC5vYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhpcy5fb3BlblN0YXJ0JC5uZXh0KG9icyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb2JzLm5leHQoKTtcbiAgICAgICAgICBvYnMuY29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSkucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5hY3RpdmVBY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMub3BlblNpZGUoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLl9kcmF3ZXJDb250YWluZXJSZWYub3BlbigpO1xuICAgICAgICAgIHRoaXMuX2FmdGVyT3BlbmVkJC5uZXh0KCk7XG4gICAgICAgICAgdGhpcy5fYWZ0ZXJPcGVuZWQkLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2UgdGhlIGRyYXdlci5cbiAgICogQHBhcmFtIHJlc3VsdCBPcHRpb25hbCByZXN1bHQgdG8gcmV0dXJuIHRvIHRoZSBkaWFsb2cgb3BlbmVyLlxuICAgKi9cbiAgcHVibGljIGNsb3NlKHJlc3VsdD86IFIpOiB2b2lkIHtcbiAgICBuZXcgT2JzZXJ2YWJsZTx2b2lkPihvYnNlcnZlciA9PiB7XG4gICAgICBpZiAodGhpcy5fY2xvc2VTdGFydCQub2JzZXJ2ZXJzLmxlbmd0aCkge1xuICAgICAgICB6aXAoLi4udGhpcy5fY2xvc2VTdGFydCQub2JzZXJ2ZXJzLm1hcChpdGVtID0+IHtcbiAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoY2xvc2VPYnNlcnZlciA9PiB7XG4gICAgICAgICAgICBpdGVtLm5leHQoY2xvc2VPYnNlcnZlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpXG4gICAgICAgIClcbiAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgb2JzZXJ2ZXIubmV4dCgpO1xuICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5lcnJvcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9ic2VydmVyLm5leHQoKTtcbiAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgIH1cblxuICAgIH0pLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICB0aGlzLl9kcmF3ZXJDb250YWluZXJSZWYuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5fcmVzdWx0ID0gcmVzdWx0O1xuICAgICAgICB0aGlzLl9hZnRlckNsb3NlZCQubmV4dChyZXN1bHQpO1xuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBzaWRlIG9mIHRoZSBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyBvcGVuU2lkZSgpIHtcbiAgICB0aGlzLl9pc1NpZGVPcGVuID0gdHJ1ZTtcbiAgICB0aGlzLl9zaWRlVG9nZ2xlLm5leHQodGhpcy5faXNTaWRlT3Blbik7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2UgdGhlIHNpZGUgb2YgdGhlIGRyYXdlclxuICAgKi9cbiAgcHVibGljIGNsb3NlU2lkZSgpIHtcbiAgICB0aGlzLl9pc1NpZGVPcGVuID0gZmFsc2U7XG4gICAgdGhpcy5fc2lkZVRvZ2dsZS5uZXh0KHRoaXMuX2lzU2lkZU9wZW4pO1xuXG4gICAgdGhpcy5zZXRBY3RpdmVBY3Rpb24obnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlIHRoZSBzaWRlIG9mIHRoZSBkcmF3ZXJcbiAgICovXG4gIHB1YmxpYyB0b2dnbGVTaWRlKCkge1xuICAgIHRoaXMuaXNTaWRlT3BlbiA/IHRoaXMuY2xvc2VTaWRlKCkgOiB0aGlzLm9wZW5TaWRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlIGFjdGl2ZSBhY3Rpb25cbiAgICogQHBhcmFtIG5hbWVcbiAgICovXG4gIHB1YmxpYyBzZXRBY3RpdmVBY3Rpb24obmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fYWN0aXZlQWN0aW9uLm5leHQobmFtZSk7XG5cbiAgICBpZiAobmFtZSkge1xuICAgICAgdGhpcy5vcGVuU2lkZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBvcGVuZWQgbWVudSByZWZlcmVuY2UgYW5kIHN1YnNjcmliZSBmb3IgYXV0byByZW1vdmVcbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIHJlZlxuICAgKi9cbiAgcHVibGljIGFkZE1lbnVSZWYobmFtZTogc3RyaW5nLCByZWY6IERyYXdlck1lbnVSZWY8VCwgUj4pIHtcbiAgICB0aGlzLl9tZW51UmVmcy5zZXQobmFtZSwgcmVmKTtcblxuICAgIHJlZi5hZnRlckNsb3NlZCgpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX21lbnVSZWZzLmRlbGV0ZShuYW1lKTtcbiAgICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogR2V0IG9wZW5lZCBtZW51IHJlZmVyZW5jZSBieSBuYW1lXG4gICAqIEBwYXJhbSBuYW1lXG4gICAqL1xuICBwdWJsaWMgZ2V0TWVudVJlZihuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVudVJlZnMuZ2V0KG5hbWUpO1xuICB9XG5cbiAgcHVibGljIGdldEFjdGlvbihuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3ZXJDb25maWcuYWN0aW9ucy5maW5kKChhY3Rpb24pID0+IGFjdGlvbi5uYW1lID09PSBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEbyB1cGRhdGUgZm9yIGljb24gZm9yIHRhcmdldCBhY3Rpb25cbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIGljb25cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVBY3Rpb25JY29uKG5hbWU6IHN0cmluZywgaWNvbjogc3RyaW5nKSB7XG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy5nZXRBY3Rpb24obmFtZSk7XG5cbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICBhY3Rpb24uaWNvbiA9IGljb247XG5cbiAgICAgIHRoaXMuX2FjdGlvbnNVcGRhdGVkJC5uZXh0KG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEbyB1cGRhdGVcbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIGRhdGFcbiAgICovXG4gIHB1YmxpYyB1cGRhdGVBY3Rpb24obmFtZTogc3RyaW5nLCBkYXRhKSB7XG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy5nZXRBY3Rpb24obmFtZSk7XG5cbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICBjb25zdCBhbGxvd2VkRmllbGRzID0gWydpY29uJywgJ3R5cGUnLCAndG9nZ2xlJywgJ3Rvb2x0aXAnLCAnY2xvc2UnLCAnY2xvc2VTaWRlJywgJ2NvbXBvbmVudCcsICdkYXRhJ107XG5cbiAgICAgIGNvbnN0IGZvclVwZGF0ZSA9IE9iamVjdC5rZXlzKGRhdGEpLmZpbHRlcigoa2V5KSA9PiBhbGxvd2VkRmllbGRzLmluZGV4T2Yoa2V5KSA+IC0xKTtcblxuICAgICAgZm9yVXBkYXRlLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICBhY3Rpb25ba2V5XSA9IGRhdGFba2V5XTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9hY3Rpb25zVXBkYXRlZCQubmV4dChuYW1lKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlRHJhd2VyV2lkdGgod2lkdGg6IG51bWJlcikge1xuICAgIHRoaXMucmVzaXplQ29udHJvbGxlci51cGRhdGVNYWluV2lkdGgod2lkdGgpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZVNpZGVEcmF3ZXJXaWR0aCh3aWR0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5yZXNpemVDb250cm9sbGVyLnVwZGF0ZVNpZGVXaWR0aCh3aWR0aCk7XG4gIH1cblxuICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICB0aGlzLl9vdmVybGF5UmVmLmRldGFjaEJhY2tkcm9wKCk7XG4gICAgdGhpcy5fb3ZlcmxheVJlZi5kZXRhY2goKTtcbiAgICB0aGlzLl9kcmF3ZXJDb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgIHRoaXMuX2RhdGFGYWN0b3J5LmRlc3Ryb3koKTtcblxuICAgIHRoaXMuX2Rlc3Ryb3kkLm5leHQoKTtcbiAgICB0aGlzLl9kZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbn1cblxuIl19