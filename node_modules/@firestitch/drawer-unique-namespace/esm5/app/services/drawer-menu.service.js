import { __decorate, __metadata } from "tslib";
import { ElementRef, Injectable, Injector } from '@angular/core';
import { ConnectedPosition, Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';
import { ComponentPortal, PortalInjector } from '@angular/cdk/portal';
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';
import { FsDrawerMenuComponent } from '../components/drawer-menu/drawer-menu.component';
import { DrawerMenuRef } from '../classes/drawer-menu-ref';
import { DrawerData } from '../classes/drawer-data';
import { DRAWER_MENU_DATA } from '../services/drawer-menu-data';
var FsDrawerMenuService = /** @class */ (function () {
    function FsDrawerMenuService(_overlay, _injector, _breakpointObserver) {
        this._overlay = _overlay;
        this._injector = _injector;
        this._breakpointObserver = _breakpointObserver;
    }
    FsDrawerMenuService.prototype.create = function (component, container, config) {
        var overlayRef = this.createOverlay(container);
        var dataFactory = DrawerData.createWithProxy(config.data);
        var menuRef = new DrawerMenuRef(overlayRef, dataFactory);
        var containerRef = this.attachContainer(overlayRef, menuRef, dataFactory);
        var componentRef = this.attachComponent(component, containerRef, menuRef, dataFactory);
        menuRef.containerRef = containerRef;
        containerRef.setDrawerMenuRef(menuRef);
        menuRef.componentRef = componentRef;
        return menuRef;
    };
    FsDrawerMenuService.prototype.createOverlay = function (container) {
        var overlayConfig = this.getOverlayConfig(container);
        return this._overlay.create(overlayConfig);
    };
    FsDrawerMenuService.prototype.getOverlayConfig = function (container) {
        var element = new ElementRef(container); // positionStrategy needs ElementRef;
        var strategy = null;
        if (this._breakpointObserver.isMatched(Breakpoints.XSmall)) {
            strategy = this._overlay
                .position()
                .global()
                .centerHorizontally()
                .centerVertically();
        }
        else {
            var positions = [
                { originX: 'start', originY: 'bottom', overlayX: 'start', overlayY: 'top' }
            ];
            strategy = this._overlay
                .position()
                .flexibleConnectedTo(element)
                .withPositions(positions);
        }
        return new OverlayConfig({
            positionStrategy: strategy,
            scrollStrategy: this._overlay.scrollStrategies.reposition(),
            hasBackdrop: true,
            backdropClass: 'cdk-overlay-transparent-backdrop'
        });
    };
    FsDrawerMenuService.prototype.attachContainer = function (overlayRef, menuRef, dataFactory) {
        var injector = this.createInjector(menuRef, dataFactory);
        var containerPortal = new ComponentPortal(FsDrawerMenuComponent, undefined, injector);
        var containerRef = overlayRef.attach(containerPortal);
        return containerRef.instance;
    };
    FsDrawerMenuService.prototype.attachComponent = function (componentRef, externalContainer, externalRef, config) {
        var injector = this.createInjector(externalRef, config);
        return externalContainer.attachComponentPortal(new ComponentPortal(componentRef, undefined, injector));
    };
    FsDrawerMenuService.prototype.createInjector = function (componentRef, dataFactory) {
        var injectionTokens = new WeakMap([
            [DrawerMenuRef, componentRef],
            [DRAWER_MENU_DATA, dataFactory]
        ]);
        return new PortalInjector(this._injector, injectionTokens);
    };
    FsDrawerMenuService.ctorParameters = function () { return [
        { type: Overlay },
        { type: Injector },
        { type: BreakpointObserver }
    ]; };
    FsDrawerMenuService = __decorate([
        Injectable(),
        __metadata("design:paramtypes", [Overlay,
            Injector,
            BreakpointObserver])
    ], FsDrawerMenuService);
    return FsDrawerMenuService;
}());
export { FsDrawerMenuService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLW1lbnUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXJlc3RpdGNoL2RyYXdlci8iLCJzb3VyY2VzIjpbImFwcC9zZXJ2aWNlcy9kcmF3ZXItbWVudS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDL0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0YsT0FBTyxFQUFFLGVBQWUsRUFBaUIsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXRFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQ3hGLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFJaEU7SUFFRSw2QkFBb0IsUUFBaUIsRUFDakIsU0FBbUIsRUFDbkIsbUJBQXVDO1FBRnZDLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIsY0FBUyxHQUFULFNBQVMsQ0FBVTtRQUNuQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW9CO0lBQzNELENBQUM7SUFFTSxvQ0FBTSxHQUFiLFVBQWMsU0FBNkIsRUFBRSxTQUFrQixFQUFFLE1BQVk7UUFDM0UsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqRCxJQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1RCxJ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QzFELElBQU0sZUFBZSxHQUFHLElBQUksT0FBTyxDQUFXO1lBQzVDLENBQUMsYUFBYSxFQUFFLFlBQVksQ0FBQztZQUM3QixDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQztTQUNoQyxDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDN0QsQ0FBQzs7Z0JBbEY2QixPQUFPO2dCQUNOLFFBQVE7Z0JBQ0Usa0JBQWtCOztJQUpoRCxtQkFBbUI7UUFEL0IsVUFBVSxFQUFFO3lDQUdtQixPQUFPO1lBQ04sUUFBUTtZQUNFLGtCQUFrQjtPQUpoRCxtQkFBbUIsQ0FxRi9CO0lBQUQsMEJBQUM7Q0FBQSxBQXJGRCxJQXFGQztTQXJGWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0VsZW1lbnRSZWYsIEluamVjdGFibGUsIEluamVjdG9yfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbm5lY3RlZFBvc2l0aW9uLCBPdmVybGF5LCBPdmVybGF5Q29uZmlnLCBPdmVybGF5UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgQ29tcG9uZW50UG9ydGFsLCBDb21wb25lbnRUeXBlLCBQb3J0YWxJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHsgQnJlYWtwb2ludE9ic2VydmVyLCBCcmVha3BvaW50cyB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9sYXlvdXQnO1xuXG5pbXBvcnQgeyBGc0RyYXdlck1lbnVDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL2RyYXdlci1tZW51L2RyYXdlci1tZW51LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEcmF3ZXJNZW51UmVmIH0gZnJvbSAnLi4vY2xhc3Nlcy9kcmF3ZXItbWVudS1yZWYnO1xuaW1wb3J0IHsgRHJhd2VyRGF0YSB9IGZyb20gJy4uL2NsYXNzZXMvZHJhd2VyLWRhdGEnO1xuaW1wb3J0IHsgRFJBV0VSX01FTlVfREFUQSB9IGZyb20gJy4uL3NlcnZpY2VzL2RyYXdlci1tZW51LWRhdGEnO1xuXG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGc0RyYXdlck1lbnVTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5LFxuICAgICAgICAgICAgICBwcml2YXRlIF9pbmplY3RvcjogSW5qZWN0b3IsXG4gICAgICAgICAgICAgIHByaXZhdGUgX2JyZWFrcG9pbnRPYnNlcnZlcjogQnJlYWtwb2ludE9ic2VydmVyKSB7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlKGNvbXBvbmVudDogQ29tcG9uZW50VHlwZTxhbnk+LCBjb250YWluZXI6IEVsZW1lbnQsIGNvbmZpZz86IGFueSkge1xuICAgIGNvbnN0IG92ZXJsYXlSZWYgPSB0aGlzLmNyZWF0ZU92ZXJsYXkoY29udGFpbmVyKTtcbiAgICBjb25zdCBkYXRhRmFjdG9yeSA9IERyYXdlckRhdGEuY3JlYXRlV2l0aFByb3h5KGNvbmZpZy5kYXRhKTtcbiAgICBjb25zdCBtZW51UmVmID0gbmV3IERyYXdlck1lbnVSZWYob3ZlcmxheVJlZiwgZGF0YUZhY3RvcnkpO1xuICAgIGNvbnN0IGNvbnRhaW5lclJlZiA9IHRoaXMuYXR0YWNoQ29udGFpbmVyKG92ZXJsYXlSZWYsIG1lbnVSZWYsIGRhdGFGYWN0b3J5KTtcbiAgICBjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLmF0dGFjaENvbXBvbmVudChjb21wb25lbnQsIGNvbnRhaW5lclJlZiwgbWVudVJlZiwgZGF0YUZhY3RvcnkpO1xuICAgIG1lbnVSZWYuY29udGFpbmVyUmVmID0gY29udGFpbmVyUmVmO1xuICAgIGNvbnRhaW5lclJlZi5zZXREcmF3ZXJNZW51UmVmKG1lbnVSZWYpO1xuXG4gICAgbWVudVJlZi5jb21wb25lbnRSZWYgPSBjb21wb25lbnRSZWY7XG5cbiAgICByZXR1cm4gbWVudVJlZjtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlT3ZlcmxheShjb250YWluZXI6IEVsZW1lbnQpOiBPdmVybGF5UmVmIHtcbiAgICBjb25zdCBvdmVybGF5Q29uZmlnID0gdGhpcy5nZXRPdmVybGF5Q29uZmlnKGNvbnRhaW5lcik7XG4gICAgcmV0dXJuIHRoaXMuX292ZXJsYXkuY3JlYXRlKG92ZXJsYXlDb25maWcpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRPdmVybGF5Q29uZmlnKGNvbnRhaW5lcjogRWxlbWVudCk6IE92ZXJsYXlDb25maWcge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBuZXcgRWxlbWVudFJlZihjb250YWluZXIpOyAvLyBwb3NpdGlvblN0cmF0ZWd5IG5lZWRzIEVsZW1lbnRSZWY7XG5cbiAgICBsZXQgc3RyYXRlZ3kgPSBudWxsO1xuICAgIGlmICh0aGlzLl9icmVha3BvaW50T2JzZXJ2ZXIuaXNNYXRjaGVkKEJyZWFrcG9pbnRzLlhTbWFsbCkpIHtcbiAgICAgIHN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAucG9zaXRpb24oKVxuICAgICAgICAuZ2xvYmFsKClcbiAgICAgICAgLmNlbnRlckhvcml6b250YWxseSgpXG4gICAgICAgIC5jZW50ZXJWZXJ0aWNhbGx5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uczogQ29ubmVjdGVkUG9zaXRpb25bXSA9IFtcbiAgICAgICAgeyBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJyB9XG4gICAgICBdO1xuICAgICAgc3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgIC5mbGV4aWJsZUNvbm5lY3RlZFRvKGVsZW1lbnQpXG4gICAgICAgIC53aXRoUG9zaXRpb25zKHBvc2l0aW9ucyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBPdmVybGF5Q29uZmlnKHtcbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3k6IHN0cmF0ZWd5LFxuICAgICAgc2Nyb2xsU3RyYXRlZ3k6ICB0aGlzLl9vdmVybGF5LnNjcm9sbFN0cmF0ZWdpZXMucmVwb3NpdGlvbigpLFxuICAgICAgaGFzQmFja2Ryb3A6IHRydWUsXG4gICAgICBiYWNrZHJvcENsYXNzOiAnY2RrLW92ZXJsYXktdHJhbnNwYXJlbnQtYmFja2Ryb3AnXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaENvbnRhaW5lcjxULCBSPihvdmVybGF5UmVmOiBPdmVybGF5UmVmLCBtZW51UmVmOiBEcmF3ZXJNZW51UmVmPFQsIFI+LCBkYXRhRmFjdG9yeTogRHJhd2VyRGF0YSkge1xuICAgIGNvbnN0IGluamVjdG9yID0gdGhpcy5jcmVhdGVJbmplY3RvcihtZW51UmVmLCBkYXRhRmFjdG9yeSk7XG4gICAgY29uc3QgY29udGFpbmVyUG9ydGFsID0gbmV3IENvbXBvbmVudFBvcnRhbChGc0RyYXdlck1lbnVDb21wb25lbnQsIHVuZGVmaW5lZCwgaW5qZWN0b3IpO1xuICAgIGNvbnN0IGNvbnRhaW5lclJlZiA9IG92ZXJsYXlSZWYuYXR0YWNoPEZzRHJhd2VyTWVudUNvbXBvbmVudD4oY29udGFpbmVyUG9ydGFsKTtcblxuICAgIHJldHVybiBjb250YWluZXJSZWYuaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaENvbXBvbmVudDxULCBSPihcbiAgICBjb21wb25lbnRSZWY6IENvbXBvbmVudFR5cGU8VD4sXG4gICAgZXh0ZXJuYWxDb250YWluZXI6IEZzRHJhd2VyTWVudUNvbXBvbmVudCxcbiAgICBleHRlcm5hbFJlZjogRHJhd2VyTWVudVJlZjxULCBSPixcbiAgICBjb25maWc6IGFueSxcbiAgKSB7XG5cbiAgICBjb25zdCBpbmplY3RvciA9IHRoaXMuY3JlYXRlSW5qZWN0b3IoZXh0ZXJuYWxSZWYsIGNvbmZpZyk7XG5cbiAgICByZXR1cm4gZXh0ZXJuYWxDb250YWluZXIuYXR0YWNoQ29tcG9uZW50UG9ydGFsPFQ+KFxuICAgICAgbmV3IENvbXBvbmVudFBvcnRhbDxUPihjb21wb25lbnRSZWYsIHVuZGVmaW5lZCwgaW5qZWN0b3IpXG4gICAgKTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBjcmVhdGVJbmplY3Rvcihjb21wb25lbnRSZWYsIGRhdGFGYWN0b3J5OiBEcmF3ZXJEYXRhKSB7XG4gICAgY29uc3QgaW5qZWN0aW9uVG9rZW5zID0gbmV3IFdlYWtNYXA8YW55LCBhbnk+KFtcbiAgICAgIFtEcmF3ZXJNZW51UmVmLCBjb21wb25lbnRSZWZdLFxuICAgICAgW0RSQVdFUl9NRU5VX0RBVEEsIGRhdGFGYWN0b3J5XVxuICAgIF0pO1xuXG4gICAgcmV0dXJuIG5ldyBQb3J0YWxJbmplY3Rvcih0aGlzLl9pbmplY3RvciwgaW5qZWN0aW9uVG9rZW5zKTtcbiAgfVxufVxuIl19